(function( blueConic, undefined ) {var p='http://plugins.blueconic.net/';var ps='https://plugins.blueconic.net/';(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.BCClass=function(){};BCClass.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.constructor=c;c.extend=arguments.callee;return c}})();var InteractionType=BCClass.extend({init:function(a){},getPreloadProperties:function(){return[]},getContent:function(){},onEvent:function(){},importLibraries:function(c){var e=[];var a=[];if(!c||c.length===0){return}for(var b=0;b<c.length;b++){var d=c[b];if(d&&d.sharing==="none"){e.push(d.url)}else{a.push(d.url)}}blueConic.fn.importLibraries.call(this,e);blueConic.fn.importAndCacheLibraries.call(this,a)}});(function(){ var ARTICLE="article",PRODUCT="product",EVENT_SHOPPING_CART="shoppingcart",EVENT_ORDER="order",InteractionTypeImpl=InteractionType.extend({init:function(t,e){this.blueConicClient=t,this.context=e,this.profile=this.context.getProfile();var i=this.context.getParameters();this.storeId=i.storeId&&i.storeId[0]||null,this.metadata=i.metadata&&i.metadata[0]||null,this.requiredOptionSet=i.requiredOptionSet&&"true"===i.requiredOptionSet[0],this.type="connection_content_collector"===this.context.getInteractionTypeId()?ARTICLE:PRODUCT,this._initProductProperties(i)},_initProductProperties:function(t){this.type===PRODUCT&&(t.lastCartUpdateProperty&&t.lastCartUpdateProperty[0]&&(this.lastCartUpdateProperty=t.lastCartUpdateProperty[0]),t.nrProductsInCartProperty&&t.nrProductsInCartProperty[0]&&(this.nrProductsInCartProperty=t.nrProductsInCartProperty[0]),this._subscribeToShoppingEvents())},_subscribeToShoppingEvents:function(){this.blueConicClient.event.subscribe(EVENT_SHOPPING_CART,this,this._handleShoppingEvent),this.blueConicClient.event.subscribe(EVENT_ORDER,this,this._handleShoppingEvent)},_updateShoppingcartItems:function(t){this.blueConicClient.recommendation.createEvent({storeId:this.storeId,action:EVENT_SHOPPING_CART,itemId:t,profileId:this.profile.getId()}),this.nrProductsInCartProperty&&this._storeItemsInShoppingCart(t),this.lastCartUpdateProperty&&this._storeCurrentDateAsLastCartUpdate(),(this.nrProductsInCartProperty||this.lastCartUpdateProperty)&&this.blueConicClient.profile.updateProfile()},_storeItemsInShoppingCart:function(t){this.profile.setValue(this.nrProductsInCartProperty,t.length)},_storeCurrentDateAsLastCartUpdate:function(){this.profile.setValue(this.lastCartUpdateProperty,this.blueConicClient.getCurrentDate().getTime())},_updateBoughtItems:function(t){this.blueConicClient.recommendation.createEvent({storeId:this.storeId,action:EVENT_ORDER,itemId:t,profileId:this.profile.getId()})},_handleShoppingEvent:function(t,e){if(e&&e.productIds&&(!e.storeId||e.storeId===this.storeId)){var i=this.blueConicClient.util.array.ensureArray(e.productIds);t===EVENT_SHOPPING_CART?this._updateShoppingcartItems(i):t===EVENT_ORDER&&(this._updateBoughtItems(i),this._updateShoppingcartItems([]))}},_isValidItem:function(t,e,i){if(!t.itemId)return this.blueConicClient.util.log("Item will not be scraped due to missing item ID"),!1;if(!t.name)return this.blueConicClient.util.log("Item will not be scraped due to missing name"),!1;if(!t.url)return this.blueConicClient.util.log("Item will not be scraped due to missing URL"),!1;if(!/^https?:\/\//.test(t.url))return this.blueConicClient.util.log("Item will not be scraped due to invalid URL: "+t.url),!1;if(t.pageType!==this.type)return this.blueConicClient.util.log("Item will not be scraped due to incorrect type: "+t.pageType+" !== "+this.type),!1;if(this.type===ARTICLE&&!t.publicationDate)return this.blueConicClient.util.log("Item will not be scraped due to missing publication date"),!1;if(this.requiredOptionSet)for(var r=["id","url","name","type","publicationDate"],n=0;n<i.length;n++)if(i[n].required&&-1===r.indexOf(i[n].fieldId)){var o=e.getFieldValue(i[n]);if(null==o||0===o.length)return this.blueConicClient.util.log("Item will not be scraped due to missing value for required field: "+i[n].fieldId),!1}return!0},onLoad:function(){if(this.storeId){var t=this.metadata?this.blueConicClient.json.parse(this.metadata):null,e=new window.BlueConicMetaDataService(this.jQuery,t,this.type,document.location.href);e.blueConicClient=this.blueConicClient;var i=e.getItemData(t);if(this._isValidItem(i,e,t)){var r=this._makeMetaDataHash(e,t);this._handleView(i.itemId,i.url,r,e)}this._check404Page(i.itemId,window.location.toString())}},_handleView:function(t,e,i,r){this.referrer=document.referrer;var n=this.referrer.replace(/http[s]?:\/\/(.*?)(:|\?|\/|$).*/,"$1"),o=window.location.hostname,s={storeId:this.storeId,action:"view",itemId:t,url:e,profileId:this.profile.getId(),isEntrypage:n!==o,hash:i},a=r.getLastModifiedInMs();a&&(s.lastmodified=a),this.blueConicClient.recommendation.createEvent(s)},_makeMetaDataHash:function(t,e){var i=t.getMetaDataValues(e);return this.md5(this.blueConicClient.json.stringify(i))},_check404Page:function(t,e){if(t){for(var i=[this.jQuery("title").text(),this.jQuery('meta[property="description"]').attr("content"),this.jQuery('meta[property="og:title"]').attr("content"),this.jQuery("h1").text()],r=["not found","404","niet gevonden","sorry","probleem"],n=!1,o=this.storeId,s=0;s<i.length;s++){var a=i[s];if(a)for(var l=0;l<r.length;l++){var u=r[l]||"";if(-1!==a.toLowerCase().indexOf(u)){n=!0;break}}}n&&t&&this.jQuery.ajax({url:e,type:"HEAD",statusCode:{404:this.jQuery.proxy(function(){this.blueConicClient.recommendation.createEvent({itemId:t,url:t,storeId:o,lastmodified:(new Date).getTime()})},this)}})}}});var a = [];var i='connection_content_collector';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/3.2.4/frontend/src/lib/md5.min.js', sharing: 'local'});a.push({url: p + i + '/3.2.4/frontend/src/node_modules/@blueconic/frontend-metadataservice/metaDataService.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/3.2.4/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({PF_PROPERTY_PREFIX:"tlpf",STANDARD_EVENTS:["ViewContent","Search","AddToCart","AddToWishlist","InitiateCheckout","AddPaymentInfo","Purchase","Lead","CompleteRegistration"],MIGRATED_SEGMENT_ID:"migrated-segment",SENT_TO_SYSTEM_PROPERTY:"sent_to_system",SENT_TO_CONNECTION_PROPERTY:"sent_to_connection",init:function(t,e){this.blueConicClient=t,this.context=e,this.profile=this.context.getProfile(),this.parameters=this.context.getParameters(),this._migrate(),this.pixelId=this.parameters.pixelId[0],this.goals=this._parseGoals(),this.segments=this.blueConicClient.getSegments()},getPreloadProperties:function(){var t=this._getFrontendGoals(this.parameters).reduce(function(t,e){var n=JSON.parse(e.parameters.exportMapping[0]).filter(function(t){return"property"===t.from.dataType&&t.from.values&&t.from.values.length>0}).map(function(t){return t.from.values[0].id});return t.concat(n)},[]).concat(this.goals.reduce(function(t,e){return t.push(e.context.LAST_PUSH_PROPERTY),t.push(e.context.VARIABLE_STATE_PUSH_PROPERTY),t},[]));return t.push(this.SENT_TO_CONNECTION_PROPERTY),t.push(this.SENT_TO_SYSTEM_PROPERTY),t},onLoad:function(){if(0!==this.goals.length&&this.pixelId){this._createFacebookScript(),window.fbq("init",this.pixelId);for(var t=0;t<this.goals.length;t++)this._handleGoal(this.goals[t].goal,this.goals[t].context)}},_parseGoals:function(){var t=this._getFrontendGoals(this.parameters);if(0===t.length||!this.pixelId)return[];for(var e=[],n=0;n<t.length;n++)if(this._shouldGoalExecute(t[n])){var r=this._parseGoal(t[n]);e.push({goal:r,context:this._createGoalContext(r)})}return e},_getFrontendGoals:function(t){return t.frontendGoals.map(JSON.parse)},_createFacebookScript:function(){var t,e,n,r,i,s;t=window,e=document,n="script",t.fbq||(r=t.fbq=function(){r.callMethod?r.callMethod.apply(r,arguments):r.queue.push(arguments)},t._fbq||(t._fbq=r),r.push=r,r.loaded=!0,r.version="2.0",r.queue=[],(i=e.createElement(n)).async=!0,i.src="https://connect.facebook.net/en_US/fbevents.js",(s=e.getElementsByTagName(n)[0]).parentNode.insertBefore(i,s))},_parseGoal:function(t){var e=t.parameters;return e.exportMapping=JSON.parse(this._getValue("exportMapping",e)),e.pushFrequency=this._getValue("pushFrequency",e),e.exportSegment=this._getValue("exportSegment",e),e.eventName=this._getValue("eventName",e),e.events=[],e.triggerEvent&&e.events.push(e.triggerEvent),"plc"===e.pushFrequency&&e.events.push(this.blueConicClient.event.onProfilePermissionChange),e},_getValue:function(t,e){return e[t]&&e[t][0]||null},_getValues:function(t,e){return e[t]?e[t]:[]},_handleGoal:function(t,e){if(!1!==this._validSegment(t.exportSegment)){var n=this;t.events.forEach(function(r){n.blueConicClient.event.subscribe(r,n,function(){setTimeout(function(){n.profile.loadValues(n.preloadProperties,n,function(){n._pushGoalData(t,e)})},200)})}),this.bcConnectionUtil.doPush(e)&&this._pushGoalData(t,e)}},_pushGoalData:function(t,e){for(var n={},r=!1,i=0;i<t.exportMapping.length;i++){var s=t.exportMapping[i];if(s.from){var a=this.bcConnectionUtil.getVariableValue(s.from,e,!0).filter(function(t){return null!=t});a&&a.length>0&&(n[s.to.values[0].id]=1===a.length?a[0]:a,r=!0)}}if(r){var o=t.eventName||"BlueConic";this._isStandardEvent(o)?window.fbq("track",o,n):window.fbq("trackCustom",o,n),this.bcConnectionUtil.setSyncProperties(this.context,this.profile,[this.SENT_TO_SYSTEM_PROPERTY,this.SENT_TO_CONNECTION_PROPERTY])}},_validSegment:function(t){if(t===this.MIGRATED_SEGMENT_ID)return!0;for(var e=0;e<this.segments.length;e++)if(this.segments[e].id===t)return!0;return!1},_createGoalContext:function(t){return{LAST_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"lt"+this.context.getInteractionId(),VARIABLE_STATE_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"st"+this.context.getInteractionId(),push_frequency:t.pushFrequency||null,profile:this.profile,variables:[]}},_shouldGoalExecute:function(t){return this.context.getGoals().some(function(e){return e.getId()===t.id})},_isStandardEvent:function(t){for(var e=0;e<this.STANDARD_EVENTS.length;e++)if(t===this.STANDARD_EVENTS[e])return!0;return!1},_migrate:function(){(this.parameters.version&&this.parameters.version[0]?parseInt(this.parameters.version[0]):1)<3&&this._migrateToV3()},_migrateToV3:function(){var t=this.parameters.eventName,e=this.parameters.push_frequency,n=JSON.parse(this.parameters.variables).map(function(t){return{from:{typeId:t.type,values:[{id:t.property}]},to:{typeId:"text",dataType:"text",values:[{id:t.key}]}}});this.parameters.frontendGoals=[],this.parameters.frontendGoals.push(JSON.stringify({id:"migrated-goal-"+Math.round(1e3*Math.random()),active:!0,type:"export-pixel",parameters:{exportMapping:[JSON.stringify(n)],eventName:t,triggerEvent:null,pushFrequency:e,exportSegment:[this.MIGRATED_SEGMENT_ID]}}))}});var a = [];var i='connection_facebook_ads';a.push({url: p + i + '/4.3.0/frontend/src/node_modules/@blueconic/connection_lib/connection_lib.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/4.3.0/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({PF_PROPERTY_PREFIX:"tlpf",SCRIPT_URL:"https://snap.licdn.com/li.lms-analytics/insight.min.js",init:function(a,b){this.blueConicClient=a,this.context=b,this.profile=this.context.getProfile(),this.parameters=this.context.getParameters(),this.pixelId=this._getValue("pixelId",this.parameters),this.segments=this.blueConicClient.getSegments(),this.goals=this._parseGoals()},onLoad:function(){0!==this.goals.length&&this.pixelId&&this.goals.forEach(function(a){this._handleGoal(a.goal,a.context)},this)},_parseGoals:function(){var a=this._getFrontendGoals(this.parameters);if(0===a.length||!this.pixelId)return[];for(var b,c=[],d=0;d<a.length;d++)b=this._parseGoal(a[d]),c.push({goal:b,context:this._createGoalContext(b)});return c},_getFrontendGoals:function(a){return a.frontendGoals.map(JSON.parse)},_parseGoal:function(a){var b=a.parameters;return b.pushFrequency=this._getValue("pushFrequency",b),b.exportSegment=this._getValue("exportSegment",b),b},_getValue:function(a,b){return b[a]?b[a][0]||null:null},_handleGoal:function(a,b){!1===this._validSegment(a.exportSegment)||this.bcConnectionUtil.doPush(b)&&this._pushGoalData()},_pushGoalData:function(){this.pixelId&&(window._linkedin_data_partner_id=this.pixelId,this.blueConicClient.util.loadScript(this.SCRIPT_URL,this,function(){this.bcConnectionUtil.setSyncProperties(this.context,this.profile,["sent_to_system","sent_to_connection"])}))},_validSegment:function(a){for(var b=0;b<this.segments.length;b++)if(this.segments[b].id===a)return!0;return!1},_createGoalContext:function(a){return{LAST_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"lt"+this.context.getInteractionId(),push_frequency:a.pushFrequency||null,profile:this.profile}}});var a = [];var i='connection_linkedin_insight_tag';a.push({url: '/plugins/connection_linkedin_insight_tag/js/connection_lib/connection_lib.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : 'https://woodmackenzie.blueconic.net/plugins/connection_linkedin_insight_tag/ts_a7fe2a1f97cd4c6b4cfdf59df68dbb45/'}]);})();(function(){ var ARTICLE="article",PRODUCT="product",EVENT_SHOPPING_CART="shoppingcart",EVENT_ORDER="order",InteractionTypeImpl=InteractionType.extend({init:function(t,e){this.blueConicClient=t,this.context=e,this.profile=this.context.getProfile();var i=this.context.getParameters();this.storeId=i.storeId&&i.storeId[0]||null,this.metadata=i.metadata&&i.metadata[0]||null,this.requiredOptionSet=i.requiredOptionSet&&"true"===i.requiredOptionSet[0],this.type="connection_content_collector"===this.context.getInteractionTypeId()?ARTICLE:PRODUCT,this._initProductProperties(i)},_initProductProperties:function(t){this.type===PRODUCT&&(t.lastCartUpdateProperty&&t.lastCartUpdateProperty[0]&&(this.lastCartUpdateProperty=t.lastCartUpdateProperty[0]),t.nrProductsInCartProperty&&t.nrProductsInCartProperty[0]&&(this.nrProductsInCartProperty=t.nrProductsInCartProperty[0]),this._subscribeToShoppingEvents())},_subscribeToShoppingEvents:function(){this.blueConicClient.event.subscribe(EVENT_SHOPPING_CART,this,this._handleShoppingEvent),this.blueConicClient.event.subscribe(EVENT_ORDER,this,this._handleShoppingEvent)},_updateShoppingcartItems:function(t){this.blueConicClient.recommendation.createEvent({storeId:this.storeId,action:EVENT_SHOPPING_CART,itemId:t,profileId:this.profile.getId()}),this.nrProductsInCartProperty&&this._storeItemsInShoppingCart(t),this.lastCartUpdateProperty&&this._storeCurrentDateAsLastCartUpdate(),(this.nrProductsInCartProperty||this.lastCartUpdateProperty)&&this.blueConicClient.profile.updateProfile()},_storeItemsInShoppingCart:function(t){this.profile.setValue(this.nrProductsInCartProperty,t.length)},_storeCurrentDateAsLastCartUpdate:function(){this.profile.setValue(this.lastCartUpdateProperty,this.blueConicClient.getCurrentDate().getTime())},_updateBoughtItems:function(t){this.blueConicClient.recommendation.createEvent({storeId:this.storeId,action:EVENT_ORDER,itemId:t,profileId:this.profile.getId()})},_handleShoppingEvent:function(t,e){if(e&&e.productIds&&(!e.storeId||e.storeId===this.storeId)){var i=this.blueConicClient.util.array.ensureArray(e.productIds);t===EVENT_SHOPPING_CART?this._updateShoppingcartItems(i):t===EVENT_ORDER&&(this._updateBoughtItems(i),this._updateShoppingcartItems([]))}},_isValidItem:function(t,e,i){if(!t.itemId)return this.blueConicClient.util.log("Item will not be scraped due to missing item ID"),!1;if(!t.name)return this.blueConicClient.util.log("Item will not be scraped due to missing name"),!1;if(!t.url)return this.blueConicClient.util.log("Item will not be scraped due to missing URL"),!1;if(!/^https?:\/\//.test(t.url))return this.blueConicClient.util.log("Item will not be scraped due to invalid URL: "+t.url),!1;if(t.pageType!==this.type)return this.blueConicClient.util.log("Item will not be scraped due to incorrect type: "+t.pageType+" !== "+this.type),!1;if(this.type===ARTICLE&&!t.publicationDate)return this.blueConicClient.util.log("Item will not be scraped due to missing publication date"),!1;if(this.requiredOptionSet)for(var r=["id","url","name","type","publicationDate"],n=0;n<i.length;n++)if(i[n].required&&-1===r.indexOf(i[n].fieldId)){var o=e.getFieldValue(i[n]);if(null==o||0===o.length)return this.blueConicClient.util.log("Item will not be scraped due to missing value for required field: "+i[n].fieldId),!1}return!0},onLoad:function(){if(this.storeId){var t=this.metadata?this.blueConicClient.json.parse(this.metadata):null,e=new window.BlueConicMetaDataService(this.jQuery,t,this.type,document.location.href);e.blueConicClient=this.blueConicClient;var i=e.getItemData(t);if(this._isValidItem(i,e,t)){var r=this._makeMetaDataHash(e,t);this._handleView(i.itemId,i.url,r,e)}this._check404Page(i.itemId,window.location.toString())}},_handleView:function(t,e,i,r){this.referrer=document.referrer;var n=this.referrer.replace(/http[s]?:\/\/(.*?)(:|\?|\/|$).*/,"$1"),o=window.location.hostname,s={storeId:this.storeId,action:"view",itemId:t,url:e,profileId:this.profile.getId(),isEntrypage:n!==o,hash:i},a=r.getLastModifiedInMs();a&&(s.lastmodified=a),this.blueConicClient.recommendation.createEvent(s)},_makeMetaDataHash:function(t,e){var i=t.getMetaDataValues(e);return this.md5(this.blueConicClient.json.stringify(i))},_check404Page:function(t,e){if(t){for(var i=[this.jQuery("title").text(),this.jQuery('meta[property="description"]').attr("content"),this.jQuery('meta[property="og:title"]').attr("content"),this.jQuery("h1").text()],r=["not found","404","niet gevonden","sorry","probleem"],n=!1,o=this.storeId,s=0;s<i.length;s++){var a=i[s];if(a)for(var l=0;l<r.length;l++){var u=r[l]||"";if(-1!==a.toLowerCase().indexOf(u)){n=!0;break}}}n&&t&&this.jQuery.ajax({url:e,type:"HEAD",statusCode:{404:this.jQuery.proxy(function(){this.blueConicClient.recommendation.createEvent({itemId:t,url:t,storeId:o,lastmodified:(new Date).getTime()})},this)}})}}});var a = [];var i='connection_product_collector';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/3.1.7/frontend/src/node_modules/@blueconic/frontend-metadataservice/metaDataService.js', sharing: 'local'});a.push({url: p + i + '/3.1.7/frontend/src/lib/md5.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/3.1.7/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({PF_PROPERTY_PREFIX:"tlpf",EMAIL:"em",init:function(a,b){this.blueConicClient=a,this.context=b,this.profile=this.context.getProfile(),this.parameters=this.context.getParameters(),this.pixelId=this._getValue("pixelId",this.parameters),this.segments=this.blueConicClient.getSegments(),this.goals=this._parseGoals()},onLoad:function(){0!==this.goals.length&&this.pixelId&&this._handleGoal(this.goals[0].goal,this.goals[0].context)},_parseGoals:function(){var a=this._getFrontendGoals(this.parameters);if(0===a.length||!this.pixelId)return[];for(var b,c=[],d=0;d<a.length;d++)b=this._parseGoal(a[d]),c.push({goal:b,context:this._createGoalContext(b)});return c},_getFrontendGoals:function(a){return a.frontendGoals.map(JSON.parse)},_createTwitterScript:function(){!function(g,d,e,f,a,b){g.twq||(f=g.twq=function(){f.exe?f.exe.apply(f,arguments):f.queue.push(arguments)},f.version="1.1",f.queue=[],a=d.createElement(e),a.async=!0,a.src="//static.ads-twitter.com/uwt.js",b=d.getElementsByTagName(e)[0],b.parentNode.insertBefore(a,b))}(window,document,"script")},_parseGoal:function(a){var b=a.parameters;return b.pushFrequency=this._getValue("pushFrequency",b),b.exportSegment=this._getValue("exportSegment",b),b},_getValue:function(a,b){return b[a]?b[a][0]||null:null},_handleGoal:function(a,b){!1===this._validSegment(a.exportSegment)||this.bcConnectionUtil.doPush(b)&&(this._createTwitterScript(),this._pushGoalData())},_pushGoalData:function(){this.pixelId&&(window.twq("init",this.pixelId),window.twq("track","PageView"),this.bcConnectionUtil.setSyncProperties(this.context,this.profile,["sent_to_system","sent_to_connection"]))},_validSegment:function(a){for(var b=0;b<this.segments.length;b++)if(this.segments[b].id===a)return!0;return!1},_createGoalContext:function(a){return{LAST_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"lt"+this.context.getInteractionId(),VARIABLE_STATE_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"st"+this.context.getInteractionId(),push_frequency:a.pushFrequency||null,profile:this.profile}}});var a = [];var i='connection_twitter_ads';a.push({url: '/plugins/connection_twitter_ads/js/connection_lib/connection_lib.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : 'https://woodmackenzie.blueconic.net/plugins/connection_twitter_ads/ts_7b6b807ab252be3153fb13f0ea63b9c5/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b?b:null,this.profile=this.context.getProfile(),this.parameters=this.context.getParameters(),this.connectionContext={SENT_TO_SYSTEM_PROPERTY:"sent_to_system",SENT_TO_CONNECTION_PROPERTY:"sent_to_connection"},this.preloadProperties=[this.connectionContext.SENT_TO_SYSTEM_PROPERTY,this.connectionContext.SENT_TO_CONNECTION_PROPERTY]},_getDomain:function(){return /[^.]+(?:\.[^.]+)?$/.exec(document.domain)[0]},_deleteCookie:function(a){document.cookie=a+"=; domain="+this._getDomain()+"; path=/; expires=Thu, 01-Jan-70 00:00:01 GMT;"},getPreloadProperties:function(){return this.preloadProperties},_updateCookie:function(){var a=this.parameters.cookieName&&this.parameters.cookieName[0]?this.parameters.cookieName[0]:"bcVWOCookie";if(this.parameters.segments){var b=this.blueConicClient.getSegments().filter(function(a){return-1<this.parameters.segments.indexOf(a.id)},this).map(function(a){return a.name}),c=b.sort().join("||"),d=this.blueConicClient.util.cookie.getCookie(a);if(d!==c){this.blueConicClient.util.cookie.setCookie(a,c);for(var e,f=this.parameters.experiments||[],g=0;g<f.length;g++)e=f[g],this._deleteCookie("_vis_opt_exp_"+e+"_combi");this.bcConnectionUtil.setSyncProperties(this.context,this.profile,[this.connectionContext.SENT_TO_SYSTEM_PROPERTY,this.connectionContext.SENT_TO_CONNECTION_PROPERTY])}}},onLoad:function(){this._updateCookie(),this.blueConicClient.event.subscribe(this.blueConicClient.event.onSegmentChange,this,this._updateCookie)}});var a = [];var i='connection_vwo';a.push({url: p + i + '/1.0.9/js/connection_lib/connection_lib.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.0.9/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(e,t){this.blueConicClient=e,this.context=t||null,this.parameters=this.context.getParameters(),this.profile=e.profile.getProfile(),this.isInEditMode=e.isInEditMode(),this._createdElements=[],this.parameters&&this.parameters.content&&(this._fragment=this._createFragment(this.parameters.content))},_createFragment:function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.getElementsByTagName("div"),i=0;i<n.length;i++)n[i].getAttribute("data-bc-external")&&(n[i].innerHTML="");return t},onLoad:function(){if(this.element=this.context.getDOMElement(),this.element){window.bc=window.bc||{},window.bc.jQuery=this.jQuery,window.bc.$=this.jQuery;var e=this.element.cloneNode(!0),t=this;this.loadInteraction(function(n,i){if(n)return console.error("[BC] Content interaction couldn't be loaded because of the following error(s)",n),void(t.isInEditMode||(console.error("[BC] The element will be restored to it's previous content"),t._createdElements.forEach(function(e){e.remove()}),t.element.replaceWith?t.element.replaceWith(e):t.element.innerHTML=e.innerHTML));t._createdElements=i.createdElements,t.isInEditMode?t.blueConicClient.event.publish("contentinteractiontype.interactionLoaded",{interaction:t}):t.blueConicClient.createEvent("VIEW",t.context.getInteractionId())})}},loadInteraction:function(e,t){var n="boolean"!=typeof(t=t||{}).loadContent||t.loadContent,i=window._bcp.interactionUtil,r=this.getValue("content");r||(r=this.element.innerHTML);var l=[];n&&l.push(i.createContentHandler({content:r,interactionId:this.context.getInteractionId(),bcEvent:this.blueConicClient.event,isInEditMode:this.isInEditMode,jQuery:this.jQuery})),l.push(i.createCssHandler({cssUrl:this.getValue("styling_css")}),i.createAdvancedHandler({blueConicClient:this.blueConicClient,interactionId:this.context.getInteractionId(),clickEventSelector:this.getValue("click_event_selector"),jQuery:this.jQuery}),i.createJavaScriptHandler({interactionId:this.context.getInteractionId(),javaScriptUrls:this.getValues("javascript_urls"),inlineJavaScript:this.getValue("javascript"),isInEditMode:this.isInEditMode})),i.runHandlers(this.element,l,e)},getPreloadProperties:function(){for(var e,t=this.context.getParameters().content+"",n=/data-bc-preload="([^"]*)"/g,i=[];null!==(e=n.exec(t));)for(var r=e[1].split(","),l=0;l<r.length;l++)i.push(r[l]);return i||[]},getContent:function(){return this.loadInlineStyling(),this._fragment?this._fragment.innerHTML:null},loadInlineStyling:function(){var e=this.getValue("styling_css_inline");e?(this._inlineStylingElement||(this._inlineStylingElement=document.createElement("style"),document.head.appendChild(this._inlineStylingElement),this._createdElements.push(this._inlineStylingElement)),this._inlineStylingElement.innerHTML=e):this._inlineStylingElement&&(this._inlineStylingElement.remove(),this._inlineStylingElement=null)},onMessageReceived:function(e){this.blueConicClient.event.publish("contentinteractiontype.messageReceived",e)},getValue:function(e){return this.parameters[e]&&this.parameters[e][0]?this.parameters[e][0]:null},getValues:function(e){return this.parameters[e]||[]}});var a = [];var i='contentinteractiontype';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/1.1.24/frontend/src/scripts/handlerUtil.js', sharing: 'none'});a.push({url: p + i + '/1.1.24/frontend/src/scripts/handleCss.js', sharing: 'none'});a.push({url: p + i + '/1.1.24/frontend/src/scripts/handleContent.js', sharing: 'none'});a.push({url: p + i + '/1.1.24/frontend/src/scripts/handleJavaScript.js', sharing: 'none'});a.push({url: p + i + '/1.1.24/frontend/src/scripts/handleAdvanced.js', sharing: 'none'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.24/'},{ id : 'html', baseUrl : ps + 'html/1.0.10/'},{ id : 'string', baseUrl : ps + 'string/1.0.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({html:{nl:{content:'<div class="bcCSContent">Plaats hier uw content</div>'},"default":{content:'<div class="bcCSContent">Place your content here</div>'}},init:function(a,b){this.blueConicClient=a,this.context=b?b:null,this.profile=a.profile.getProfile(),this.element=this.context.getDOMElement(),this.identifier='bc_'+this.context.getInteractionId(),this.parameters=this.context.getParameters(),this.currentInsertType=this.parameters.inserttype&&this.parameters.inserttype[0]?this.parameters.inserttype[0]:'replace','replacecontainer'!==this.currentInsertType||document.getElementById(this.identifier)||this._hidePosition();var c=this.parameters.content+'';this.htmlFragment=this._createElement(c),this._lastEvent=null,this._inlineCss=null,this._lastCheckDate=null,this._timeoutID=null},getPreloadProperties:function(){return this.htmlFragment?this._getPropertiesFromPlaceholders(this.htmlFragment.innerHTML):[]},getContent:function(){return(this._handleStyling(),!this.htmlFragment)?null:(this.element||(this.element=this.context.getDOMElement()),'replace'===this.currentInsertType)?(this._emptyElementsWithAttribute(this.htmlFragment,'div','data-bc-external'),this.htmlFragment.innerHTML):void 0},onUpdate:function(){this.currentInsertType!==this.context.getParameters().inserttype[0]&&document.location.reload()},onLoad:function(){window.bc=window.bc||{},window.bc.jQuery=this.jQuery,window.bc.$=this.jQuery,this.currentInsertType&&this._placeContent()},onMessageReceived:function(a){a.parameters&&(this.parameters=a.parameters),'updateStyling'===a.action&&(this.inlineCss&&(document.head.removeChild(this.inlineCss),this.inlineCss=null),this._handleStyling())},_hidePosition:function(){this.styleIdentifier='bcCS'+this.context.getInteractionId();var a=this.context.getPosition()+' {opacity: 0 !important}',b=document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0],c=document.createElement('style');c.type='text/css',c.id=this.styleIdentifier,c.styleSheet?c.styleSheet.cssText=a:c.innerHTML=a,b.appendChild(c)},_showPosition:function(){this.jQuery('#'+this.styleIdentifier).remove()},_placeContent:function(){var a=this.element||this.context.getDOMElement();if(a&&(this._handleStyling(),this.blueConicClient.isInEditMode()||this._handleURLs(this.htmlFragment),'replace'===this.currentInsertType?this._replaceContent(a):this.htmlFragment&&(this._emptyElementsWithAttribute(this.htmlFragment,'div','data-bc-external'),this._setContent()),!this.blueConicClient.isInEditMode())){var b=this.parameters.clickselector&&this.parameters.clickselector[0]?this.parameters.clickselector[0]:'';if(b){this.jQuery('body').one('click',b,this.jQuery.proxy(function(a){this._lastEvent&&this._lastEvent.originalEvent===a.originalEvent||this._logClickEvent(a)},this));try{this.jQuery(b).one('click',this.jQuery.proxy(function(a){this.lastEvent=a,this._logClickEvent(a)},this))}catch(a){}}var c=!!this.parameters.forceclick&&('true'===this.parameters.forceclick[0]||!0===this.parameters.forceclick[0]);c&&this.blueConicClient.createEvent('CLICK',this.context.getInteractionId());var d=this.parameters.javascript&&this.parameters.javascript[0]?this.parameters.javascript[0]:'';if(d)try{d=d.replace(/(^|\W)blueConicVariantId(\W|$)/g,'$1"'+this.context.getInteractionId()+'"$2'),this.jQuery('<script>'+d+'</script>').appendTo(this.jQuery('body'))}catch(a){console.error(a)}}},_replaceContent:function(a){this._assureVisibilty(a);var b=this.getContent();if(b){var c=a.nodeName?a.nodeName.toLowerCase():a.nodeName;if(-1===this.blueConicClient.util.array.indexOfArray(['area','base','br','col','command','embed','hr','img','input','keygen','link','meta','param','source','track','wbr'],c)){if(this.blueConicClient.isInEditMode&&this.blueConicClient.isInEditMode())a.innerHTML!==b&&(a.innerHTML=b);else try{this.jQuery(a).html(b)}catch(a){console.error(a)}}else if(a.parentNode){var d=a.parentNode.innerHTML,e=document.createElement('div');e.appendChild(a.cloneNode(!0));var f=e.innerHTML,g=d.replace(f,b);a.parentNode.innerHTML!==g&&(a.parentNode.innerHTML=g)}this._handleComplexObjects(a),this._trackView(a)}},_setContent:function(){var a=this._getElementByPosition(this.context.getPosition());if(a){var b=a.parent().get(0),c=this.jQuery('[data-bc-id="'+this.identifier+'"],#'+this.identifier);if(0<c.length)return this.blueConicClient.isInEditMode&&this.blueConicClient.isInEditMode()?null:(c.replaceWith(this.htmlFragment.innerHTML),this._handleComplexObjects(b),void('prepend'===this.currentInsertType?(a.prev().attr('data-bc-id',this.identifier),this._trackView(a.prev().get(0))):'append'===this.currentInsertType&&(a.next().attr('data-bc-id',this.identifier),this._trackView(a.next().get(0)))));if('prepend'===this.currentInsertType){var d=a.prev();if(0<d.length&&d.attr('data-bc-id')===this.identifier)return;if(this.blueConicClient.isInEditMode&&this.blueConicClient.isInEditMode())a.get(0).parentNode.insertBefore(this.htmlFragment,a.get(0)),this.blueConicClient.functions.setEditableNode('#bc_'+this.context.getInteractionId(),{positionName:'prepend',lockPosition:!0,redrawPosition:!0});else{try{a.before(this.htmlFragment.innerHTML)}catch(a){console.error(a)}var e=a.prev();e.attr('data-bc-id',this.identifier),this._trackView(e.get(0))}}if('append'===this.currentInsertType){var f=a.next();if(0<f.length&&f.attr('data-bc-id')===this.identifier)return;if(this.blueConicClient.isInEditMode&&this.blueConicClient.isInEditMode())a.get(0).parentNode.insertBefore(this.htmlFragment,a.get(0).nextSibling),this.blueConicClient.functions.setEditableNode('#bc_'+this.context.getInteractionId(),{positionName:'append',lockPosition:!0,redrawPosition:!0});else{try{a.after(this.htmlFragment.innerHTML)}catch(a){console.error(a)}var g=a.next();g.attr('data-bc-id',this.identifier),this._trackView(g.get(0))}}if('replacecontainer'===this.currentInsertType){if(this.blueConicClient.isInEditMode&&this.blueConicClient.isInEditMode())a.get(0).parentNode.replaceChild(this.htmlFragment,a.get(0)),this.blueConicClient.functions.setEditableNode('#bc_'+this.context.getInteractionId(),{positionName:'replace container',lockPosition:!0,redrawPosition:!0});else{var h=this.jQuery(this.htmlFragment.innerHTML).replaceAll(a);this._trackView(h.get(0))}this._showPosition()}this.blueConicClient.isInEditMode()&&null===this.context.getInteractionId()&&setTimeout(function(){window.blueConicClient.fn.postMessage('onOpenEditMode',window.blueConicClient.positionHandlers[0])},500),this._handleComplexObjects(b)}},_trackView:function(a){if(!this.blueConicClient.isInEditMode()){var b=!!(this.parameters.trackviewwhenvisible&&this.parameters.trackviewwhenvisible[0])&&'true'===this.parameters.trackviewwhenvisible[0];b?this._isVisible(a)?this.blueConicClient.createEvent('VIEW',this.context.getInteractionId()):(this._lastCheckDate=new Date().getTime(),this.jQuery(document).on('scroll.bcCSP'+this.identifier,this.jQuery.proxy(function(){this._checkVisibility(a)},this)),this.jQuery(window).on('resize.bcCSP'+this.identifier,this.jQuery.proxy(function(){this._checkVisibility(a)},this)),this._checkVisibility(a)):this.blueConicClient.createEvent('VIEW',this.context.getInteractionId())}},_checkVisibility:function(a){var b=new Date().getTime();return 500<=b-this._lastCheckDate&&(this._lastCheckDate=new Date().getTime(),this._isVisible(a))?(this.blueConicClient.createEvent('VIEW',this.context.getInteractionId()),this.jQuery(document).off('scroll.bcCSP'+this.identifier),this.jQuery(window).off('resize.bcCSP'+this.identifier),void clearTimeout(this._timeoutID)):void(clearTimeout(this._timeoutID),this._timeoutID=setTimeout(this.jQuery.proxy(function(){this._checkVisibility(a)},this),1500))},_isVisible:function(a){var b=a.getBoundingClientRect();return 0<=b.top&&b.top<window.innerHeight&&this.jQuery(a).is(':visible')},_logClickEvent:function(a){if(!(a&&a.originalEvent&&a.originalEvent._blueConicLoggedClickEvent===this.context.getInteractionId())){var b=a&&a.target&&a.target.pathname&&a.target.hostname&&0===a.target.pathname.indexOf('/s/')&&-1!==a.target.hostname.indexOf('blueconic');b||(a.originalEvent&&(a.originalEvent._blueConicLoggedClickEvent=this.context.getInteractionId()),this.blueConicClient.createEvent('CLICK',this.context.getInteractionId()))}},_getElementByPosition:function(a){var b=document.getElementById(a);return b=b?this.jQuery(b):this.jQuery(a),b},_createElement:function(a){var b;if(!a)if(this.blueConicClient.isInEditMode()&&('prepend'===this.currentInsertType||'append'===this.currentInsertType)){var c='nl'===this.context.getLocale()?'nl':'default';a=this.html[c].content}else return null;try{b=document.createElement('div'),b.id=this.identifier,b.innerHTML=a}catch(a){return null}return b},_handleURLs:function(a){var b=!!(this.parameters.newwindow&&this.parameters.newwindow[0])&&'true'===this.parameters.newwindow[0];if(b)for(var c=a.getElementsByTagName('a'),d=0,e=c.length;d<e;d++){var f=c[d],g=f.getAttribute('target');g||f.setAttribute('target','_blank')}this._handlePlaceholders(a)},_assureVisibilty:function(a){this.blueConicClient.isInEditMode&&this.blueConicClient.isInEditMode()&&(a.style.minWidth='10px',a.style.minHeight='10px')},_handlePlaceholders:function(a){for(var b=this._getPropertiesFromPlaceholders(a.innerHTML),c=0;c<b.length;c++){var d=b[c],e=this.profile.getValue(d)||'',f=new RegExp('\\$\\{'+d+'\\}','g');a.innerHTML=a.innerHTML.replace(f,encodeURI(e))}},_getPropertiesFromPlaceholders:function(a){for(var b,c=/\$\{([a-zA-Z\-_0-9]+)\}/g,d=[];null!==(b=c.exec(a));)d.push(b[1]);for(var e=/data-bc-preload="([^"]*)"/g,f=[];null!==(b=e.exec(a));)for(var g=b[1].split(','),h=0;h<g.length;h++)f.push(g[h]);return d.concat(f)},_emptyElementsWithAttribute:function(a,b,c){for(var d,e=this.getElementsWithAttribute(a,b,c),f=0,g=e.length;f<g;f++)d=e[f],d.innerHTML=''},getElementsWithAttribute:function(a,b,c){for(var d,e=[],f=a.getElementsByTagName(b),g=0,h=f.length;g<h;g++)d=f[g],d.getAttribute(c)&&e.push(d);return e},_handleComplexObjects:function(a){for(var b=this.getElementsWithAttribute(a,'div','data-bc-pluginid'),c=0;c<b.length;c++){var d=b[c],e=d.getAttribute('data-bc-pluginid'),f=d.getAttribute('data-bc-config');if(f)try{var g=f.replace(/\n/g,'\\\\n').replace(/\r/g,'\\\\r').replace(/\t/g,'\\\\t');f=this.blueConicClient.json.parse(g)}catch(a){f=null}this.blueConicClient.event.publish('bcComplexObject',{plugin:e,config:f,node:d,interactionId:this.context.getInteractionId()}),this.blueConicClient.isInEditMode()||(d.removeAttribute('data-bc-pluginid'),d.removeAttribute('data-bc-config'))}},_handleStyling:function(){var a='bcIS'+this.context.getInteractionId(),b=this.parameters.styling_css_inline&&this.parameters.styling_css_inline[0]?this.parameters.styling_css_inline[0]:'';b&&(this.inlineCss=document.getElementById(a),this.inlineCss||(this.inlineCss=document.createElement('style'),this.inlineCss.id=a,this.inlineCss.innerHTML=b.replace(/&#xd;/gi,''),document.head.appendChild(this.inlineCss)))}});var a = [];var i='contentinteractiontypespecial';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : 'https://woodmackenzie.blueconic.net/plugins/contentinteractiontypespecial/ts_25b8fc569d2bb21e2b65eaf5782e7c3a/'},{ id : 'boolean', baseUrl : ps + 'boolean/1.0.1/'},{ id : 'html', baseUrl : ps + 'html/1.0.10/'},{ id : 'string', baseUrl : ps + 'string/1.0.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({DEFAULT_MAX_AGE:7776000000,MAX_ITEMS:100,SKIP_LIMITED:"limited",RESET_ROLLING:"rolling",RESET_CALENDAR:"calendar",init:function(a,b){this.blueConicClient=a,this.context=b,this.interactionId="cm"+this.context.getInteractionId(),this.historyProperty="_cm_"+this.interactionId,this.profile=this.context.getProfile(),this.parameters=this.context.getParameters(),this.preLoadProperties=[this.historyProperty],this.excludeRules=[];try{this.excludeRules=this.blueConicClient.json.parse(this.parameters.excludeRules[0])}catch(a){}if(0<this.excludeRules.length){var c=this.excludeRules.filter(function(a){return"expression"===a.area.selectedoption&&-1!==a.area.expression.indexOf("getValue")});this.preLoadProperties=this.preLoadProperties.concat(c.map(function(a){return this._getPropertyIdsFromExpression(a.area.expression)},this))}this.includeRules=[];try{this.includeRules=this.blueConicClient.json.parse(this.parameters.includeRules[0])}catch(a){}if(0<this.includeRules.length){var d=this.includeRules.filter(function(a){return"expression"===a.area.selectedoption&&-1!==a.area.expression.indexOf("getValue")});this.preLoadProperties=this.preLoadProperties.concat(d.map(function(a){return this._getPropertyIdsFromExpression(a.area.expression)},this))}this.freeRules=[];try{this.freeRules=this.blueConicClient.json.parse(this.parameters.freeRules[0])}catch(a){}0<this.freeRules.length&&(this.freeRules=this.freeRules.filter(function(a){return!!a.property}),this.preLoadProperties=this.preLoadProperties.concat(this.freeRules.map(function(a){return a.property.id}))),this.expireAt=parseInt(this.parameters.expireAt[0]),isNaN(this.expireAt)&&(this.expireAt=10),this.resetAfter=this.parameters.resetAfter[0],this.uniqueOnly="true"===this.parameters.uniqueOnly[0],this.onceOnly=!!(this.parameters.onceOnly&&"true"===this.parameters.onceOnly[0]),this.now=this.blueConicClient.getCurrentDate(),this.maxAge=this._getMaxAge(),this.delayMetering=!!(this.parameters.delayMetering&&"true"===this.parameters.delayMetering[0]),this.eventSubscribed=!1,this.blueConicClient.event.subscribe(this.blueConicClient.event.onUrlChange,this,function(){this.onLoad()})},getPreloadProperties:function(){return this.preLoadProperties},onLoad:function(){if(this.delayMetering&&!this.eventSubscribed)return this.eventSubscribed=!0,void this.blueConicClient.event.subscribe("cm_start_metering",this,function(){this.onLoad()});var a=this._visitorQualifies();if(a){var b={};try{var c=this.profile.getValue(this.historyProperty);c&&(b=this.blueConicClient.json.parse(this.profile.getValue(this.historyProperty)))}catch(a){}this.history=new this.History(b,this.maxAge,this.now);var d=this._getCurrentView();if(d){var e=!d.isSkippedView||d.isSkippedView&&!!d.skippedFor;e?(this._addViewToHistory(d),!d.isSkippedView&&this._writeExtraProfileProperties(d),this.blueConicClient.profile.updateProfile(this,function(){this._throwEvents(d)})):this._throwEvents(d)}}},_throwEvents:function(a){var b=this._getCurrentViews(a);(a.isHistoricallyAllowedView||a.isHistoricallyAllowedFreeView)&&this.blueConicClient.createEvent("cm_already_viewed"),a.isFreeView?(this.blueConicClient.createEvent("cm_free_view"),(this.onceOnly&&!a.isHistoricallyAllowedFreeView||!this.onceOnly)&&(this.freeViewTracker.consumedFreeCount===this.freeViewTracker.totalFree?this.blueConicClient.createEvent("cm_last_free_view"):this.blueConicClient.createEvent("cm_free_view_"+this.freeViewTracker.consumedFreeCount))):((this.onceOnly&&!a.isHistoricallyAllowedView&&!a.isSkippedView||!this.onceOnly)&&(1===b?this.blueConicClient.createEvent("cm_firstview"):b===this.expireAt-1?this.blueConicClient.createEvent("cm_lastview"):b<this.expireAt&&this.blueConicClient.createEvent("cm_view_"+b)),b>=this.expireAt&&this.blueConicClient.createEvent("cm_exceeded"),a.isSkippedView&&this.blueConicClient.createEvent("cm_excluded"));var c=this.parameters.bottomFrom&&this.parameters.bottomFrom[0]?parseInt(this.parameters.bottomFrom[0]):null,d=this.parameters.bottomTo&&this.parameters.bottomTo[0]?parseInt(this.parameters.bottomTo[0]):null,e=this.parameters.middleFrom&&this.parameters.middleFrom[0]?parseInt(this.parameters.middleFrom[0]):null,f=this.parameters.middleTo&&this.parameters.middleTo[0]?parseInt(this.parameters.middleTo[0]):null,g=this.parameters.topFrom&&this.parameters.topFrom[0]?parseInt(this.parameters.topFrom[0]):null,h=this.parameters.topTo&&this.parameters.topTo[0]?parseInt(this.parameters.topTo[0]):null;c&&d&&b>=c&&b<=d&&this.blueConicClient.createEvent("cm_bottom"),e&&f&&b>=e&&b<=f&&this.blueConicClient.createEvent("cm_middle"),g&&h&&b>=g&&b<=h&&this.blueConicClient.createEvent("cm_top")},_addViewToHistory:function(a){this._getCurrentViews(a)>=this.expireAt&&!a.isFreeView||(a.isFreeView?this.history.free.push({u:a.url,ff:a.freeFor,ts:a.timestamp}):a.isSkippedView?this.history.skipped.push({u:a.url,sf:a.skippedFor,ts:a.timestamp}):(this.history.included.push({u:a.url,v:a.includeValue,ts:a.timestamp}),a.isAddedToHistory=!0),this.history.included.length>this.MAX_ITEMS&&(this.history.included.sort(function(c,a){var b=c.ts,d=a.ts;return b<d?-1:b>d?1:0}),this.history.included.shift()),this.profile.setValue(this.historyProperty,this.blueConicClient.json.stringify(this.history)))},_writeExtraProfileProperties:function(a){var b=this._getCurrentViews(a),c=this.parameters.expireAtProperty&&this.parameters.expireAtProperty[0]?this.parameters.expireAtProperty[0]:null,d=this.parameters.numViewsProperty&&this.parameters.numViewsProperty[0]?this.parameters.numViewsProperty[0]:null,e=this.parameters.numViewsLeftProperty&&this.parameters.numViewsLeftProperty[0]?this.parameters.numViewsLeftProperty[0]:null,f=this.parameters.numFreeViewsProperty&&this.parameters.numFreeViewsProperty[0]?this.parameters.numFreeViewsProperty[0]:null,g=this.parameters.numFreeViewsLeftProperty&&this.parameters.numFreeViewsLeftProperty[0]?this.parameters.numFreeViewsLeftProperty[0]:null;if(c&&"null"!==c&&this.profile.setValue(c,this.expireAt),d&&"null"!==d&&this.profile.setValue(d,b<=this.expireAt?b:this.expireAt),e&&"null"!==e&&this.profile.setValue(e,b<this.expireAt?this.expireAt-b:0),a.isFreeView&&(f&&"null"!==f&&this.profile.setValue(f,this.freeViewTracker.consumedFreeCount),g&&"null"!==g)){var h=this.freeViewTracker.totalFree-this.freeViewTracker.consumedFreeCount;this.profile.setValue(g,0<h?h:0)}},_getCurrentView:function(){var a=(this.jQuery("meta[property=\"og:url\"]").attr("content")||document.location.href).toLowerCase(),b=document.referrer.toLowerCase(),c=new this.PageView(a,b,this.now);return c.isHistoricallyAllowedView=this._isHistoricallyAllowed(a),c.includeValue=this._getIncludeValue(c),0<c.includeValue?(c.isSkippedView=this._isPageViewSkipped(c),this._getCurrentViews(c)>=this.expireAt&&this._setPageViewFree(c),c):null},_getIncludeValue:function(a){for(var b,c=0;c<this.includeRules.length;c++)if(b=this.includeRules[c],this._isRuleApplicable(b,a))return b.views;return 0},_isPageViewSkipped:function(a){var b=new this.SkippedViewTracker(this),c=this;return this.excludeRules.filter(function(b){return c._isRuleApplicable(b,a)}).some(function(d){if(d.skip.selectedoption!==c.SKIP_LIMITED)return!0;return!(b.skipped[d.id]=b.skipped[d.id]?b.skipped[d.id]+1:1,!(b.skipped[d.id]<=d.skip.views))&&(a.skippedFor=d.id,!0)})},_setPageViewFree:function(a){var b=this;this.freeViewTracker=new this.FreeViewTracker(this),a.isHistoricallyAllowedFreeView=this._isHistoricallyAllowedFree(a.url),this.freeRules.filter(function(c){return b._isRuleApplicable(c,a)}).forEach(function(c){b.freeViewTracker.totalFree+=c.views,a.isFreeView||(a.isHistoricallyAllowedFreeView?(a.freeFor=c.id,a.isFreeView=!0):(b.freeViewTracker.free[c.id]=b.freeViewTracker.free[c.id]?b.freeViewTracker.free[c.id]+1:1,b.freeViewTracker.free[c.id]<=c.views&&(a.freeFor=c.id,a.isFreeView=!0,b.freeViewTracker.consumedFreeCount++)))})},_isRuleApplicable:function(a,b){var c=a.area.selectedoption;if("url"===c||"referrer"===c){var d="url"===c?b.url:b.referrer;if(a.anyWord||this._URLMatchesWords(d,a.containsmatches,a.words))return!0}else if("selector"===c){var e=this._getContent(a.area.selector,!0);if(e&&a.anyWord)return!0;if(a.area.selector&&a.words&&this._contentMatchesWords(e,a.containsmatches,a.words))return!0}else if("variable"===c){var f=this._getVariableValue(a.area.variable);if(f&&a.anyWord)return!0;if(f&&this._contentMatchesWords(f,a.containsmatches,a.words))return!0}else if("expression"===c){var g=this._getContent(a.area.expression,!1);if(g&&a.anyWord)return!0;if(g&&this._contentMatchesWords(g,a.containsmatches,a.words))return!0}else if("property"===c){var h=this.profile.getValues(a.property.id);if(0<h.length&&a.anyWord)return!0;var i=this;return h.some(function(b){return!!(a.words&&i._contentMatchesWords(b,a.containsmatches,a.words))||!!(a.dateTime&&!isNaN(parseInt(b))&&i.now.getTime()-parseInt(b)<=i.maxAge)})}return!1},_isHistoricallyAllowed:function(a){if(!this.uniqueOnly)return!1;var b=this.history.included.filter(function(b){return b.u===a});return 0<b.length},_isHistoricallyAllowedFree:function(a){if(!this.uniqueOnly)return!1;var b=this.history.free.filter(function(b){return b.u===a});return 0<b.length},_getCurrentViews:function(a){for(var b,c=0,d=[],e=0;e<this.history.included.length;e++)(b=this.history.included[e],!(this.uniqueOnly&&-1!==this.blueConicClient.util.array.indexOfArray(d,b.u)))&&(d.push(b.u),c+=b.v);var f=this._isHistoricallyAllowed(a.url)||a.isAddedToHistory;return f||a.isSkippedView||c!==this.expireAt-1||(c+=a.includeValue),c},_visitorQualifies:function(){var a=[];try{a=this.blueConicClient.json.parse(this.parameters.segments)}catch(a){}if(0===a.length)return!0;var b=this.blueConicClient.getSegments();if(0===b.length)return!1;for(var c,d=0;d<b.length;d++){c=b[d];for(var e,f=0;f<a.length;f++)if(e=a[f],c.id===e.id)return!0}return!1},_getMaxAge:function(){if(this.resetAfter===this.RESET_ROLLING){var a=this.parameters.resetRolling&&!isNaN(parseInt(this.parameters.resetRolling[0]))?parseInt(1e3*(60*(60*(24*this.parameters.resetRolling[0])))):this.DEFAULT_MAX_AGE;return a}return this.resetAfter===this.RESET_CALENDAR?this.now.getTime()-new Date(this.now.getFullYear(),this.now.getMonth(),1).getTime():this.DEFAULT_MAX_AGE},_contentMatchesWords:function(a,b,c){if(!a||"string"!=typeof a)return!1;a=a.toLowerCase();for(var d=0;d<c.length;d++){if("contains"===b&&-1!==a.indexOf(c[d].toLowerCase()))return!0;if("not_contains"===b){if(-1===a.indexOf(c[d].toLowerCase()))return!0;}else if(a===c[d].toLowerCase())return!0}return!1},_URLMatchesWords:function(a,b,c){for(var d=0;d<c.length;d++)if("contains"===b||"not_contains"===b){var e=this._escapeRegularExpressionCharacters(c[d]);try{var f=new RegExp(e,"i"),g=f.test(a);if(g&&"contains"===b||!g&&"not_contains"===b)return!0}catch(a){}}else if(a===c[d])return!0;return!1},_getContent:function(expression,isCssSelector){var content=null;isCssSelector||-1===expression.indexOf("return ")||(expression="(function(jQuery) {"+expression+"}(jQuery))");try{content=isCssSelector&&-1===expression.indexOf("jQuery(")?this.jQuery(expression):function(selector,jQuery,profile){return eval("var jQuery = arguments[1]"),eval("var blueConicProfile = arguments[2]"),eval(selector)}(expression,this.jQuery,this.profile)}catch(a){}if(content&&content instanceof this.jQuery){if(0<content.length){var contentArr=[];return this.jQuery.each(content,this.jQuery.proxy(function(a,b){var c=this.jQuery(b);c.attr("content")?contentArr.push(this._normalizeText(c.attr("content"))):contentArr.push(this._normalizeText(c.text()))},this)),contentArr.join().toLowerCase()}}else if(null!==content&&"undefined"!=typeof content)return"object"==typeof content||"function"==typeof value?JSON.stringify(content).toLowerCase():content.toLowerCase()},_getVariableValue:function(a){for(var b=a.replace("[",".").replace("]","").replace("\"\"",""),c=b.split("."),d=window[c.shift()];0<c.length;){if(!d)return null;d=d[c.shift()]}return d instanceof Array?d.join().toLowerCase():"object"==typeof d||"function"==typeof d?null:(""+d).toLowerCase()},_escapeRegularExpressionCharacters:function(a){return a=a.replace(/[\\?.{}+]/g,function(a){return"\\"+a}),a=a.replace(/\*/g,".*"),a},_normalizeText:function(a){return a?this.jQuery.trim(a).replace(/\r\n+|\r+|\n+/gi,"").replace(/\s+/gi," "):a},_getPropertyIdsFromExpression:function(a){for(var b,c=RegExp(/getValues?\(["']([^"']+)["']\)/,"g"),d=[];null!==(b=c.exec(a));)d.push(b[1]);return d},PageView:function(a,b,c){this.url=a,this.timestamp=c.getTime(),this.referrer=b,this.includeValue=0,this.isSkippedView=!1,this.skippedFor=null,this.isFreeView=!1,this.isHistoricallyAllowedView=!1,this.isAddedToHistory=!1},SkippedViewTracker:function(a){this.skipped={};for(var b,c=[],d=0;d<a.history.skipped.length;d++)b=a.history.skipped[d],a.uniqueOnly&&-1!==a.blueConicClient.util.array.indexOfArray(c,b.u)||(this.skipped[b.sf]=this.skipped[b.sf]?this.skipped[b.sf]+1:1),c.push(b.u)},FreeViewTracker:function(a){this.free={},this.consumedFreeCount=0,this.totalFree=0;for(var b,c=[],d=0;d<a.history.free.length;d++)b=a.history.free[d],a.uniqueOnly&&-1!==a.blueConicClient.util.array.indexOfArray(c,b.u)||(this.free[b.ff]=this.free[b.ff]?this.free[b.ff]+1:1,this.consumedFreeCount++),c.push(b.u)},History:function(a,b,c){function d(a){for(var d=a.length;d--;){var e=a[d];c.getTime()-e.ts>b&&a.splice(d,1)}return a}this.included=a.included?d(a.included):[],this.skipped=a.skipped?d(a.skipped):[],this.free=a.free?d(a.free):[]}});var a = [];var i='contentmeter';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : 'https://woodmackenzie.blueconic.net/plugins/contentmeter/ts_0e69746438ac0d7e955432554da32dc3/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(e,t){this.blueConicClient=e,this.context=t},onLoad:function(){var e=this.blueConicClient,t=this.context.getParameters(),n=this.jQuery;if(t){var r=(t.clickcandidates||[]).map(JSON.parse).map(v),i=(t.contentcandidates||[]).map(JSON.parse).map(v),a={},c={},o={};r.forEach(function(e){u(e,l)}),i.forEach(function(e){u(e,s)})}function u(t,n){var r=function(){n(t);var i=c[t.interactionId],a=o[t.selecterarea];i||a||e.position.subscribe(t.selecterarea,null,r)};e.position.subscribe(t.selecterarea,null,r),n(t)}function l(e){for(var t=d(e),r=n(e.selecterarea),i=0,a=r.length;i<a;i++)r[i].addEventListener("click",t,{once:!0})}function s(e){f(e)&&d(e)()}function f(e){if(c[e.interactionId])return!1;for(var t=n(e.selecterarea),r=0,i=t.length;r<i;r++)if(h(t[r].textContent,e.words))return!0;return!1}function d(t){return a[t.interactionId]||(a[t.interactionId]=function(n,a){var u=c[n],l=o[t.selecterarea];if(!u&&!l){var s=[];s=(s=a instanceof MouseEvent?r.filter(function(e){var t=!c[e.interactionId],n=$(e.selecterarea).is(event.target),r=$(e.selecterarea).find(event.target).length>0;return t&&(n||r)}):i.filter(function(e){return f(e)})).filter(function(e){return e.interactionId!==t.interactionId}),o[t.selecterarea]=!0,o[t.interactionId]=!0,s.forEach(function(e){o[e.selecterarea]=!0,c[e.interactionId]=!0});var d=s.map(function(e){return e.interactionId});e.createEvent("CONVERSION",n,null,function(){e.util.log("CONVERSION event registred. Interaction: ["+n+"]")},{losingInteractions:d})}}.bind(null,t.interactionId)),a[t.interactionId]}function h(e,t){if(!e||!Array.isArray(t))return!1;var n=t.filter(function(e){return Boolean(e)&&"pre_any"!==e}).map(function(e){return e.trim().toLowerCase()});if(0===n.length)return!0;for(var r=e.toLowerCase(),i=0,a=n.length;i<a;i++)if(r.indexOf(n[i])>=0)return!0;return!1}function v(e){var t=e.selecterarea;return/^pre_any/.test(t)?t="html":/^pre_header/.test(t)?t="h1, h2, h3, h4, h5, h6":/^pre_/.test(t)&&(t=t.replace(/^pre_/,"")),e.selecterarea=t,e}}});var a = [];var i='conversionlistenerinteractiontype';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.8/'}]);})();(function(){ !function(){var t=null,e=null,i=null,n=null,o=null;window.InteractionTypeImpl=InteractionType.extend({init:function(t,e){this.blueConicClient=t,this.context=e,this.parameters=this.context.getParameters(),this.customCssElements=[],this.customJsElements=[],this.isInEditMode=this.blueConicClient.isInEditMode(),this._temporyLocation=null,this._contentElement=null,this._openedOnce=!1,this._resetTimeoutId=0,this.baseURL=this.blueConicClient.getBaseURL(this.context.getInteractionTypeId())},onLoad:function(){t=window._bcp.notificationBar.Enums.FLOW_TYPE,e=window._bcp.notificationBar.Enums.POSITION,i=window._bcp.notificationBar.Enums.ENTER_ANIMATION,n=window._bcp.notificationBar.Enums.APPEAR_ON,o=window._bcp.notificationBar.Enums.CLOSE_POSITION,this.parseParameters(),this.isInEditMode&&(window._bcp.notificationBar.NotificationBar.prototype.close=function(){});var r=this;this.loadCustomContent(function(t){if(t)return r.blueConicClient.util.log(t.message);r.addBlueConicEventHandlers()})},parseParameters:function(){this.notificationBarHeight=parseInt(this.getParameter("height")),this.notificationBarHeight=isNaN(this.notificationBarHeight)?window._bcp.notificationBar.Constants.DEFAULT_HEIGHT:this.notificationBarHeight;var r=this.getParameter("location")||"top";this._position="top"===r?e.TOP:e.BOTTOM;var a=this.getParameter("close_position");if(this._closePosition="TOP_LEFT"===a?o.TOP_LEFT:"BOTTOM_RIGHT"===a?o.BOTTOM_RIGHT:o.TOP_RIGHT,this._closePadding=parseInt(this.getParameter("close_padding")),this._closePadding=isNaN(this._closePadding)?10:this._closePadding,void 0===document.body.style.animationName||!0===this.isInEditMode)this._enterAnimation=i.NONE;else switch(this.getParameter("effect")){case"slideIn":this._enterAnimation=i.SLIDE_IN;break;case"fadeIn":this._enterAnimation=i.FADE_IN;break;default:this._enterAnimation=i.NONE}var s=this.getParameters("selected_when");this._appearOnTriggers=[];for(var c=0;c<s.length;c++)switch(s[c]){case"triggerOn":this._appearOnTriggers.push(n.SCROLL_EVENT);break;case"scroll_depth":this._appearOnTriggers.push(n.SCROLL_DEPTH);break;case"click_selector":this._appearOnTriggers.push(n.ELEMENT_CLICKED);break;case"content_condition":this._appearOnTriggers.push(n.CONTENT_VISIBLE)}0===this._appearOnTriggers.length&&this._appearOnTriggers.push(n.PAGE_LOAD);var l=this.getParameter("location_type");this._type="scroll"===l?t.NON_STICKY:t.STICKY},addBlueConicEventHandlers:function(){this.blueConicClient.event.subscribe("closeoverlay",this,function(t,e){e instanceof Array&&e[0]===this.context.getInteractionId()&&this.notificationBar.close()}),this.blueConicClient.event.subscribe(this.blueConicClient.event.onUrlChange,this,function(){this.notificationBar&&this.notificationBar.isVisible&&this.notificationBar.close()})},loadCustomContent:function(t){t||(t=function(){});var e=this;this.callbackChain([this.createContentElement.bind(this),this.loadComplexObjects.bind(this),this.removeTempLocation.bind(this),this.loadCss.bind(this),this.loadCustomCss.bind(this)],function(i){return i?t(i):(e.createNotificationBar(),e.setShowEventTrigger(),e.isInEditMode&&e.blueConicClient.event.publish("notificationBar.interactionLoaded",{interaction:e}),t())})},callbackChain:function(t,e,i){var n=this;i||(i=0);try{t[i](function(o){return o?e(o):i+1>=t.length?e(null):n.callbackChain(t,e,i+1)})}catch(t){return e(t)}},createContentElement:function(t){return this._temporyLocation=document.createElement("div"),this._temporyLocation.style.display="none",document.body.appendChild(this._temporyLocation),this._contentElement=document.createElement("div"),this._contentElement=this.jQuery("<div></div>").html(this.getContent())[0],this._temporyLocation.appendChild(this._contentElement),t()},removeTempLocation:function(t){return document.body.removeChild(this._temporyLocation),t()},loadComplexObjects:function(t){this.jQuery(this._contentElement).find("div[data-bc-external]").html("");for(var e=this.jQuery(this._contentElement).find("div[data-bc-pluginid]"),i=0;i<e.length;i++){var n=e.eq(i),o=n.attr("data-bc-pluginid"),r=n.attr("data-bc-config");if(r)try{for(var a=r.match(/: *"(\\"|[^"])*\n(\\"|[^"])*"/g)||[],s=r,c=0;c<a.length;c++)s=s.replace(a[c],a[c].replace(/\n/g,"\\n"));r=this.blueConicClient.json.parse(s)}catch(t){console.error("Error parsing the config of the complex object:",t),r=null}this.blueConicClient.event.publish("bcComplexObject",{plugin:o,config:r,node:n[0],interactionId:this.context.getInteractionId()}),this.isInEditMode||(n.removeAttr("data-bc-pluginid"),n.removeAttr("data-bc-config"))}if(0===e.length)return t();var l=0,h=setInterval(function(){if(0===e.length)return clearInterval(h),clearTimeout(l),t();for(var i=e.length-1;i>=0;i--)e.eq(i).html()&&e.splice(i,1)},10);l=setTimeout(function(){return clearInterval(h),t({message:"Couldn't load the complex objects (timeout of 5000ms passed)."})},5e3)},loadCss:function(t){var e=document.createElement("link");e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet"),e.onload=function(){t()};var i=this.baseURL;e.onerror=function(e){return t({message:"Error occured loading the main css file ("+i+"frontend/src/css/notificationBar.css)",eventData:e})},this.jQuery("head").append(e),e.setAttribute("href",this.baseURL+"frontend/src/css/notificationBar.css")},loadCustomCss:function(t){var e=this,i=this.getParameter("styling_css"),n=this.getParameter("styling_css_inline");if(i){var o=document.createElement("link");o.setAttribute("type","text/css"),o.setAttribute("rel","stylesheet"),o.onload=function(){t()},o.onerror=function(n){return e.isInEditMode?(console.error("[BC] Loading the custom css failed for the following url: "+i),t()):t({message:"Loading the custom css failed for the following url: "+i,eventData:n})},this.customCssElements.push(this.jQuery(o)),this.jQuery("head").append(this.jQuery(o)),o.setAttribute("href",i)}if(n){n=n.replace(/&#xd;/gi,"");var r=this.jQuery("<style>"+n+"</style>");this.customCssElements.push(r),this.jQuery("head").append(r)}if("false"===this.getParameter("show_close")){var a=this.jQuery("<style>.bcpNotificationBarClose { display: none; }</style>");this.customCssElements.push(a),this.jQuery("head").append(a)}else if("true"===this.getParameter("custom_close")){var s=this.getParameter("close_icon"),c=this.getParameter("close_icon_hover"),l="";s&&(l+=".bcpNotificationBarCloseIcon {border-radius: 0;background-image: url("+s+");background-position: 0;background-size: contain;}.bcpNotificationBarCloseIcon:hover {background-position: 0;}"),c&&(l+=".bcpNotificationBarCloseIcon:hover {background-image: url("+c+");}");var h=this.jQuery("<style>"+l+"</style>");this.customCssElements.push(h),this.jQuery("head").append(h)}if(!i)return t()},resetCustomCss:function(){for(var t=0;t<this.customCssElements.length;t++){this.customCssElements[t].remove()}this.customCssElements=[]},setShowEventTrigger:function(){for(var t=this,e=0;e<this._appearOnTriggers.length;e++)switch(this._appearOnTriggers[e]){case n.PAGE_LOAD:this.triggerNotificationBar();break;case n.SCROLL_EVENT:this.jQuery(window).off("scroll.bcpNotificationBarTrigger").one("scroll.bcpNotificationBarTrigger",function(){t.triggerNotificationBar()});break;case n.SCROLL_DEPTH:this.jQuery(window).off("scroll.bcpNotificationBarTrigger").on("scroll.bcpNotificationBarTrigger",function(){t.jQuery(window).scrollTop()/(t.jQuery(document).height()-t.jQuery(window).height())*100>=parseInt(t.getParameter("scroll_depth"))&&(t.jQuery(window).off("scroll.bcpNotificationBarTrigger"),t.triggerNotificationBar())});break;case n.ELEMENT_CLICKED:this.jQuery(this.getParameter("click_selector")).off("click.bcpNotificationBarTrigger").on("click.bcpNotificationBarTrigger",function(){!1===t.notificationBar.isVisible&&t.triggerNotificationBar()});break;case n.CONTENT_VISIBLE:this._addTriggerOnContentHandler(t.getParameter("content_condition"))}},_addTriggerOnContentHandler:function(t){var e=this,i=null,n=null,o=function(){e.jQuery(t).length>0&&e.jQuery(t).html().length>0&&(e.triggerNotificationBar(),i&&i.disconnect(),n&&clearInterval(n))};window.MutationObserver?(i=new MutationObserver(o)).observe(document.body,{childList:!0,subtree:!0}):n=setInterval(o,1e3),o()},triggerNotificationBar:function(){var t=parseInt(this.getParameter("delay")),e=this;function i(){e.callbackChain([function(t){e._handleJavascript(function(i){return i&&!e.isInEditMode?t(i):(e._addInlineJavascript(),t())})},e.notificationBar.show.bind(e.notificationBar),function(t){return!1===e._openedOnce&&(e._addFrontEndBindings(),e._addClickEventLogger(),e.blueConicClient.createEvent("VIEW",e.context.getInteractionId()),e._openedOnce=!0),!0===e.isInEditMode&&setTimeout(function(){e.notificationBar.scrollIntoView()},1e3),t()}],function(t){t&&console.error(t)})}t&&!isNaN(t)&&!0!==this.isInEditMode||(t=0),0===t?i():setTimeout(i,1e3*t)},_addFrontEndBindings:function(){var t=this.jQuery(".bcpNotificationBarDontShowAgainLink"),e=this.jQuery(".bcpNotificationBarCloseButton"),i=this;(t.on("click",function(t){t.preventDefault(),i.blueConicClient.doNotShowAgain(i.context.getInteractionId()),i.notificationBar.close()}),e.on("click",function(){i.notificationBar.close()}),"true"===i.getParameter("hide_after_close"))&&this.jQuery(".bcpNotificationBarClose").on("click",function(){i.blueConicClient.doNotShowAgain(i.context.getInteractionId()),i.notificationBar.close()})},_addClickEventLogger:function(){var t=this.getParameter("click_event_selector");if(t){var e=this;this.jQuery(t).off("click.bcpNotificationBar").one("click.bcpNotificationBar",function(t){t&&t.target&&t.target.pathname&&t.target.hostname&&0===t.target.pathname.indexOf("/s/")&&-1!==t.target.hostname.indexOf("blueconic")||e.blueConicClient.createEvent("CLICK",e.context.getInteractionId())})}},_addInlineJavascript:function(){var t=this.getParameter("javascript");if(t&&!this.isInEditMode){t=t.replace(/(^|\W)blueConicVariantId(\W|$)/g,'$1"'+this.context.getInteractionId()+'"$2');var e=this.jQuery("<script>"+t+"<\/script>");try{e.appendTo(this.jQuery("body"))}catch(t){console.error(t)}}},_handleJavascript:function(t){var e=this.getParameters("javascript_urls")||[],i=this;if(0===e.length)return t();{var n=null,o=0;function r(){if(++o===e.length)return i.isInEditMode?t():t(n)}function a(t){(n=n||{message:"[BC] Loading for the following javascript urls failed, notificationBar will not be shown.",urls:[]}).urls.push(t),r()}for(var s=0;s<e.length;s++){var c=e[s],l=document.createElement("script");l.setAttribute("src",c),l.onload=r,l.onerror=a.bind(null,c),document.head.appendChild(l)}}},onSave:function(){return this.notificationBar.getContentHTML()},onMessageReceived:function(t){this.blueConicClient.event.publish("notificationBar.messageReceived",t)},getContent:function(){var t=this.getParameter("content");if(!t){var e="nl"===this.context.getLocale()?"nl":"default";t=window._bcp.notificationBar.Constants.HTML[e].content}return t},createNotificationBar:function(){var t=window._bcp.notificationBar.NotificationBar;this.notificationBar=new t(this.blueConicClient,this.context,this.jQuery,this._contentElement,{closePosition:this._closePosition,closePadding:this._closePadding,flowType:this._type,position:this._position,animationType:this._enterAnimation,height:this.notificationBarHeight})},resetNotificationBar:function(){this.notificationBar.domModifier.reset(!1),this.jQuery(this.notificationBar._containerElement).remove(),this.resetCustomCss();var t=this;this.loadCustomCss(function(){t.createNotificationBar(),t.notificationBar.show(),!0===t.isInEditMode&&t.notificationBar.scrollIntoView()})},getParameter:function(t){return this.parameters[t]&&this.parameters[t][0]?this.parameters[t][0]:null},getParameters:function(t){return this.parameters[t]?this.parameters[t]:[]}})}();var a = [];var i='dialogue_notification_bar';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/1.2.23/frontend/src/scripts/enumsAndConstants.js', sharing: 'none'});a.push({url: p + i + '/1.2.23/frontend/src/scripts/elementModifier.js', sharing: 'none'});a.push({url: p + i + '/1.2.23/frontend/src/scripts/domModifier.js', sharing: 'none'});a.push({url: p + i + '/1.2.23/frontend/src/scripts/notificationBar.js', sharing: 'none'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.2.23/'},{ id : 'html', baseUrl : ps + 'html/1.0.10/'},{ id : 'image', baseUrl : ps + 'image/1.0.2/'},{ id : 'number', baseUrl : ps + 'number/1.0.2/'},{ id : 'string', baseUrl : ps + 'string/1.0.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b,this.parameters=this.context.getParameters();var c=new Date(2017,8,1,0,0,0,0),d=this.blueConicClient.getCurrentDate().getTime(),e=d-c.getTime();this.days=Math.floor(e/86400000);var f=this.parameters.propertyRules&&this.parameters.propertyRules[0]?this.parameters.propertyRules[0]:null;if(f){f=a.json.parse(f),this.preLoadProperties=[];for(var g,h=0,i=0;i<f.length;i++)g=f[i],g.profileproperty&&g.decay&&g.nr&&(this.preLoadProperties.push(g.profileproperty+"_index"),g.decay>h&&(h=g.decay,this.property=g.profileproperty))}else{var j=this.parameters.property?this.parameters.property[0]:this.parameters.property;j&&(this.property=this.blueConicClient.json.parse(j)[0].profileproperty,this.preLoadProperties=[this.property+"_index"])}},getPreloadProperties:function(){return this.preLoadProperties},onLoad:function(){if(0<this.preLoadProperties.length){var a=this.context.getProfile(),b=this.parameters.engagement_rules?this.parameters.engagement_rules[0]:this.parameters.engagement_rules;if(!b)return;if(b=this.blueConicClient.json.parse(b),0===b.length)return;var c=this.parameters.interests?this.parameters.interests[0]:this.parameters.interests;c=c?this.blueConicClient.json.parse(c).values:[];var d=new this.BlueConicEngagement(this.blueConicClient,a,this.context.getInteractionId(),!0,c,this.jQuery,this.days,!0);if(d.applyEngagementRules(b),d.isChanged())d.save();else{for(var e,f=!1,g=0;g<this.preLoadProperties.length;g++)e=this.preLoadProperties[g],a.getValue(e)||(a.setValue(e,"0"),f=!0);f&&this.blueConicClient.profile.updateProfile()}}}});var a = [];var i='engagement_interest_ranking';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/6.3.1/js/engagement_service/engagementService.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/6.3.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b},getPreloadProperties:function(){return this.preloadProperties=[],this.context&&(this.preloadProperties=this.getProfilePropertiesFromParameters(this.context.getParameters())),this.preloadProperties},onLoad:function(){var a=this.context.getProfile(),b=this.context.getParameters(),c=b.listener_rules?b.listener_rules[0]:b.listener_rules;if(c){c=this.blueConicClient.json.parse(c);var d=new this.RuleService(this.blueConicClient,a,this.jQuery);d.applyRules(c),d.save()}},getProfilePropertiesFromParameters:function(a){var b=[],c=a.listener_rules?a.listener_rules[0]:a.listener_rules;if(!c)return b;c=this.blueConicClient.json.parse(c);for(var d,e=0;e<c.rules.length;e++)d=c.rules[e],d.profileproperty&&("set_if_empty"===d.addset||"merge"===d.addset)&&b.push(d.profileproperty[0].profileproperty);return b}});var a = [];var i='enrichprofilebyvisitorbehavior';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + 'enrichProfileByVisitorBehavior/5.3.1/js/ruleService.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + 'enrichProfileByVisitorBehavior/5.3.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b,this.parameters=this.context.getParameters(),this.rules=this._migrate(this.parameters.version||1)},getPreloadProperties:function(){return this.preloadProperties=[],this.context&&(this.preloadProperties=this.getProfilePropertiesFromParameters()),this.preloadProperties},onLoad:function(){if(this.rules){var a=this.context.getProfile(),b=new window.FormRuleService(this.blueConicClient,a,this.jQuery);b.applyRules(this.rules)}},getProfilePropertiesFromParameters:function(){if(this.rules){for(var a,b=[],c=0;c<this.rules.length;c++)a=this.rules[c],a.profileProperty&&"set_if_empty"===a.addset&&b.push(a.profileProperty);return b}},_migrate:function(a){var b=this.parameters.form_listener_rules?this.parameters.form_listener_rules[0]:this.parameters.form_listener_rules;return b=this.blueConicClient.json.parse(b),1===a&&(a=2,b=this._migrateToVersion2(b)),b},_migrateToVersion2:function(a){if(!a)return a;a=a.rules||a;for(var b=0;b<a.length;b++){a[b].id=a[b].id||a[b].identifier,delete a[b].identifier,a[b].profileproperty&&!a[b].profileProperty&&(a[b].profileProperty=a[b].profileproperty[0]?a[b].profileproperty[0].profileproperty||"":"",delete a[b].profileproperty);var c=this._migrateConverterMappingsToVersion2(a[b]);c&&(a[b].converter.mappings=c)}return a},_migrateConverterMappingsToVersion2:function(a){if(a&&a.converter&&a.converter.mappings){for(var b,c=[],d=0;d<a.converter.mappings.length;d++){if(b=a.converter.mappings[d],b&&b.original&&b.converted){c.push(b);continue}c.push({id:b.identifier||b.id,original:b.o,converted:b.c})}return c}}});var a = [];var i='enrichprofilewithvisitorinput';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/4.3.20/js/form_rule_service/formRuleService.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/4.3.20/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b,this.parameters=this.context.getParameters()},_ouibounce:function(){var a=this,b="sensitivity",c="delay";this.ouibounce({aggressive:!0,timer:0,sensitivity:this.parameters[b]?parseInt(this.parameters[b][0]):20,delay:this.parameters[c]?parseInt(this.parameters[c][0]):0,callback:function(){window.blueConicClient&&window.blueConicClient.exitIntentThrown||a.blueConicClient.createEvent("exitintent"),window.blueConicClient&&(window.blueConicClient.exitIntentThrown=!0)}})},onLoad:function(){this.blueConicClient.event.subscribe(this.blueConicClient.event.onUrlChange,this,function(){window.blueConicClient&&window.blueConicClient.exitIntentThrown&&(window.blueConicClient.exitIntentThrown=!1,this._ouibounce())}),this._ouibounce()}});var a = [];var i='exitintent';a.push({url: p + i + '/2.0.5/js/ouibounce.js', sharing: 'none'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/2.0.5/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({languageLabels:{nl:{defaultValidation:"Vul een valide waarde in"},default:{defaultValidation:"Please enter a valid value"}},_editorOpen:!1,init:function(e,t){this.blueConicClient=e,this.baseURL=this.blueConicClient.getBaseURL("forms");var i=this;this.blueConicClient.event.subscribe("bcComplexObject",this,function(e,s){s&&"forms"===s.plugin&&s.config&&(s.config.attributionId=s.interactionId,s.config=this._migrateConfig(s.config),this._loadLibraries(s.config).done(function(){i._loadData(s,t)}))}),this.blueConicClient.isInEditMode()&&(this._sendMessage("forms.formLoaded"),this.blueConicClient.event.subscribe("forms.updateName",this,function(e,t){var s=t.message.field;i.jQuery(".bcForm[data-bc-id='"+t.message.form+"']").find(".fieldHolder[data-bc-id='"+s.id+"'] .bcLabel").text(s.settings.label),i.jQuery(".bcForm[data-bc-id='"+t.message.form+"']").find(".fieldHolder[data-bc-id='"+s.id+"'] .buttonInput").attr("value",s.settings.label)}),this.blueConicClient.event.subscribe("forms.updateField",this,function(e,s){i._updateField(s.message.form,s.message.field,t)}),this.blueConicClient.event.subscribe("forms.updateLabelLocation",this,function(e,t){i._updateLabelLocation(t.message.form,t.message.show_labels_inline)}),this.blueConicClient.event.subscribe("forms.updateStyling",this,function(e,t){i._updateStyling(t.message.styling)}),this.blueConicClient.event.subscribe("forms.addField",this,function(e,t){i._addField(t.message.form,t.message.field,!0)}),this.blueConicClient.event.subscribe("forms.deleteField",this,function(e,t){i.jQuery(".bcForm[data-bc-id='"+t.message.form+"']").find(".fieldHolder[data-bc-id='"+t.message.fieldId+"']").remove(),i._removeSelectedState()}),this.blueConicClient.event.subscribe("forms.updateConfig",this,function(e,t){var s=i.jQuery(".bcForm[data-bc-id='"+t.message.id+"']").closest(".bccomplexobject");s.attr("data-bc-config",JSON.stringify(t.message));var n=t.message.actions.filter(function(e){return"setaddvalue"===e.type&&"set_if_empty"===e.operation&&e.property}).map(function(e){return e.property});s.attr("data-bc-preload",n.join(","))}),this.blueConicClient.event.subscribe("forms.updateOrdering",this,function(e,t){i._updateOrdering(t.message.form,t.message.ordering)}),this.blueConicClient.event.subscribe("editorOpened",this,function(){this._editorOpen=!0;var e=this;this._loadLibraries().done(function(){e._addBindings(t)})}),this.blueConicClient.event.subscribe("editorClosed",this,function(){this._editorOpen=!1,i._removeSelectedState(),i._sendMessage("forms.closeConfigurator")}))},getPreloadProperties:function(){return[]},_migrateConfig:function(e){if((e=JSON.parse(JSON.stringify(e))).actions||!e.routing)return e;var t,i=e.routing;return"form_routing_inline"===i.type?t={type:"text",text:i.inline_message}:"form_routing_url"===i.type?t={type:"url",url:i.go_to_url}:"form_routing_close_lightbox"===i.type&&(t={type:"close"}),e.actions=t?[t]:[],e},_loadLibraries:function(e){var t,i,s=this.jQuery;if(window.BlueConicJQuery=s,this.blueConicClient.isInEditMode())t=this._getLoadScriptDeferred(this.baseURL+"frontend/src/lib/datepicker.min.js"),i=this._getLoadScriptDeferred(this.baseURL+"frontend/src/lib/jquery-ui.min.js");else for(var n=0;n<e.fields.length;n++)"DatePicker"===e.fields[n].fieldType&&(t=this._getLoadScriptDeferred(this.baseURL+"frontend/src/lib/datepicker.min.js"));return s.when(t,i)},_getLoadScriptDeferred:function(e){var t=this.jQuery.Deferred();return this.blueConicClient.util.loadScript(e,this,function(){t.resolve()}),t},_updateOrdering:function(e,t){var i=(0,this.jQuery)(".bcForm[data-bc-id='"+e+"']"),s=null;t.forEach(function(e){var t=i.find(".fieldHolder[data-bc-id='"+e+"']");s?t.insertAfter(s):t.prependTo(i.find("fieldset")),s=t})},_removeSelectedState:function(){(0,this.jQuery)(".fieldHolder").removeClass("bcSelected")},_updateStyling:function(e){var t=this.jQuery;this._stylingUrl&&t("link[href='"+this._stylingUrl+"']").remove(),this._inlineCss&&this._inlineCss.remove(),this._handleStyling(e)},_handleStyling:function(e){var t=this.jQuery;e&&e.css&&(this._stylingUrl=e.css,this.blueConicClient.util.loadCSS(this._stylingUrl)),e&&e.css_inline&&(this._inlineCss=t("<style>"+e.css_inline+"</style>"),this._inlineCss.appendTo(t("body")))},_selectField:function(e,t){if(this._removeSelectedState(),e.addClass("bcSelected"),!t){var i=e.closest(".bccomplexobject").attr("data-bc-config"),s=this._jsonEscape(i);this._sendMessage("forms.fieldSelected",{form:JSON.parse(s),field:e.attr("data-bc-id")})}},_jsonEscape:function(e){return e.replace(/\n/g,"\\\\n").replace(/\r/g,"\\\\r").replace(/\t/g,"\\\\t")},_addBindings:function(e){var t=window.CKEDITOR;if(t){this.baseURL=this.blueConicClient.getBaseURL(e.getInteractionTypeId()),this.blueConicClient.util.loadCSS(this.baseURL+"frontend/src/css/formsinline.css");var i,s=this.jQuery,n=this;if(s(document).on("click",".bcForm .fieldHolder",function(){n._editorOpen&&n._selectField(s(this))}),t.currentInstance)for(i in t.currentInstance.widgets.instances)if("bccomplexobject"===t.currentInstance.widgets.instances[i].name){var a=t.currentInstance.widgets.instances[i];"forms"===s(a.wrapper.$).find(".bccomplexobject").attr("data-bc-pluginid")&&(a.on("select",function(e){s(e.sender.wrapper.$).removeClass("cke_widget_selected")}),a.on("deselect",function(){n._removeSelectedState(),n._sendMessage("forms.closeConfigurator")}))}s(".bcForm fieldset").sortable({handle:".bcDragHandle",stop:function(e){var t=[];s(".fieldHolder",s(this)).each(function(){s(this).attr("data-bc-id")&&t.push(s(this).attr("data-bc-id"))}),n._sendMessage("forms.updateOrdering",{form:JSON.parse(s(this).closest(".bccomplexobject").attr("data-bc-config")),order:t});var i=s(e.toElement);i.attr("data-bc-config")||(i=i.closest(".fieldHolder")),n._selectField(i,!0)}})}},_sendMessage:function(e,t){this.blueConicClient.fn.postMessage&&this.blueConicClient.fn.postMessage(e,t)},_addField:function(e,t,i){var s=this.jQuery,n=this,a=s(this._getFieldsHTML(t));a.appendTo(s(".bcForm[data-bc-id='"+e+"'] fieldset")),this._selectField(a,!0),i&&setTimeout(function(){n._isElementInViewport(a.get(0))||a.get(0).scrollIntoView()},100)},_isElementInViewport:function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},_updateField:function(e,t,i){var s=this.jQuery,n=this._getFieldsHTML(t,!0);s(".bcForm[data-bc-id='"+e+"']").find(".fieldHolder[data-bc-id='"+t.id+"']").html(n),this._addDatePickerHandleForField(t,i)},_updateLabelLocation:function(e,t){var i=this.jQuery;t?i(".bcForm[data-bc-id='"+e+"']").find("fieldset").addClass("inlineLabels"):i(".bcForm[data-bc-id='"+e+"']").find("fieldset").removeClass("inlineLabels")},_loadData:function(e,t){var i=this,s=this.jQuery,n=e.node;n.innerHTML="",this.baseURL=this.blueConicClient.getBaseURL(t.getInteractionTypeId());var a=s('<link type="text/css" href="'+this.baseURL+'frontend/src/css/default.uni-form.css" rel="stylesheet" />');a.on("load",function(){i._handleStyling(e.config.styling),i._loadForm(n,e.config,t),i._editorOpen&&i._addBindings(t)}),s("head").append(a)},_loadForm:function(e,t,i){var s=this.jQuery;this._node=e;var n=s('<div class="bcForm" data-bc-external="true" data-bc-id="'+t.id+'"></div>');n.appendTo(s(e)),this._getForm(t).appendTo(n),this.blueConicClient.isInEditMode()?this._addDatePickerHandler(n,t,i):this._prefillForm(n,t,i)},_getForm:function(e){var t=this.jQuery;e.styling||(e.styling={});var i=t('<div id="'+e.id+'" class="uniForm" action="#"></div>'),s=t('<div class="formHolder"></div>');s.appendTo(i);var n=t("<fieldset />");e.styling.show_labels_inline&&n.addClass("inlineLabels"),n.appendTo(s);for(var a=e.fields,l=0;l<a.length;l++){var r=a[l];t(this._getFieldsHTML(r)).appendTo(n)}return i},_getFieldsHTML:function(e,t){var i='<% if(settings.description) { %><span class="formHint"><%= settings.description %></span><% } %>',s="<% if(settings.required) { %><em>*</em><% } %>",n="";switch(e.fieldType){case"PlainText":n='<div class="plaintext"><%= settings.text %></div>';break;case"SingleLineText":"small"===e.settings.fieldSize||e.settings.fieldSize;n='<div<% if (settings.className) {%> class="<%= settings.className %>"<% } %>><label>'+s+'<span class="bcLabel"><%= settings.label %></span></label><input type="text" class="'+("small"===e.settings.fieldSize?"bcSmall":"large"===e.settings.fieldSize?"bcLarge":"bcMedium")+' textInput" placeholder="<%= settings.value %>" />'+i+"</div>";break;case"TextArea":n='<div<% if (settings.className) {%> class="<%= settings.className %>"<% } %>><label>'+s+'<span class="bcLabel"><%= settings.label %></span></label><textarea rows="'+("small"===e.settings.fieldSize?3:"large"===e.settings.fieldSize?10:5)+'" placeholder="<%= settings.value %>"></textarea>'+i+"</div>";break;case"Select":n='<div<% if (settings.className) {%> class="<%= settings.className %>"<% } %>><label>'+s+'<span class="bcLabel"><%= settings.label %></span></label><select class="selectInput"><% if (settings.values) for(var i=0; i < settings.values.length; i++) { %><option<% if(settings.values[i].defaultOn) { %> selected="selected"<% } %> value="<%= escape(settings.values[i].identifier || "") %>"><%= settings.values[i].name %></option><% } %></select>'+i+"</div>";break;case"CheckboxList":n='<div<% if (settings.className) {%> class="<%= settings.className %>"<% } %>><label>'+s+'<span class="bcLabel"><%= settings.label %></span></label><ul <% if(settings.repeatdirection === "horizontal") { %>class="horizontal"<% } %>><%  if (settings.values) for(var i=0; i < settings.values.length; i++) { %><li><input<% if(settings.values[i].defaultOn) { %> checked="checked"<% } %> type="checkbox" name="bcCList_<%= id %>" id="bcCList_<%= id %>_<%= i %>" value="<%= escape(settings.values[i].identifier || "") %>"/><label for="bcCList_<%= id %>_<%= i %>"><%= settings.values[i].name %></label></li><% } %></ul>'+i+"</div>";break;case"RadioButtonList":n='<div<% if (settings.className) {%> class="<%= settings.className %>"<% } %>><label>'+s+'<span class="bcLabel"><%= settings.label %></span></label><ul <% if(settings.repeatdirection === "horizontal") { %>class="horizontal"<% } %>><%  if (settings.values) for(var i=0; i < settings.values.length; i++) { %><li><input<% if(settings.values[i].defaultOn) { %> checked="checked"<% } %> type="radio" name="bcRadioList_<%= id %>" id="bcRadioList_<%= id %>_<%= i %>" value="<%= escape(settings.values[i].identifier || "") %>"/><label for="bcRadioList_<%= id %>_<%= i %>"><%= settings.values[i].name %></label></li><% } %></ul>'+i+"</div>";break;case"DatePicker":n='<div<% if (settings.className) {%> class="<%= settings.className %>"<% } %>><label>'+s+'<span class="bcLabel"><%= settings.label %></span></label><% if(settings.flat) { %><div class="datepicker"/><input type="hidden" class="hiddenInput"/><% } else { %><input type="text" class="textInput" placeholder="<%= settings.value %>" /><input type="hidden" class="hiddenInput"/><% } %>'+i+"</div>";break;case"Button":n='<div class="buttonHolder<% if (settings.className) {%> <%= settings.className %><% } %>"><input type="<% if (settings.submitForm === false) {%>button<% } else { %>submit<% } %>" class="buttonInput primaryAction" value="<%= settings.label %>"/></div>'}return this.blueConicClient.isInEditMode()&&(n+='<div class="bcDragHandle"><div class="bcInnerDragHandle"></div></div>'),t||(n='<div class="fieldHolder blueConic<%= fieldType %>" data-bc-id="<%= id %>">'+n+"</div>"),this._tmpl(n,e)},_prefillForm:function(e,t,i){for(var s=i.getProfile(),n=e.find(".fieldHolder"),a=[],l=0;l<t.fields.length;l++){var r=t.fields[l];r.settings.prefillproperty&&a.push(r.settings.prefillproperty)}0!==a.length?s.loadValues(a,this,function(){this._addFormListeners(e,t,i);for(var a=0;a<t.fields.length;a++){var l=t.fields[a],r=this.jQuery(n[a]).find("input, textarea, select");if(l.settings.prefillproperty){var o=s.getValues(l.settings.prefillproperty);if(o.length>0)switch(l.fieldType){case"DatePicker":break;case"CheckboxList":case"Checkbox":case"RadioButtonList":case"RadioButton":for(var d=0;d<o.length;d++)r.filter('[value="'+o[d]+'"]').attr("checked","checked");break;default:r.val(o[0])}}}}):this._addFormListeners(e,t,i)},_formatDate:function(e){var t=e.getMonth()+1,i=e.getDate();return e.getYear()+1900+"-"+(t<10?"0":"")+t+"-"+(i<10?"0":"")+i},_addDatePickerHandler:function(e,t,i){for(var s=0;s<t.fields.length;s++){var n=t.fields[s];this._addDatePickerHandleForField(n,i)}},_getDateForTimestamp:function(e){if(!e)return null;var t=new Date(parseInt(e));return t&&t instanceof Date&&!isNaN(t)?t:null},_addDatePickerHandleForField:function(e,t){var i=this.jQuery;if("DatePicker"===e.fieldType){var s,n=i("div[data-bc-id='"+e.id+"']"),a=this.blueConicClient.profile.getProfile(),l="nl"===t.getLocale()?"NL":"EN",r=this._getDateForTimestamp(a.getValue(e.settings.prefillproperty));r?(s=r,i(".textInput",n).val(this._formatDate(s))):s=e.settings.pickerOffset?new Date(e.settings.pickerOffset):new Date,i("input.textInput, div.datepicker",n).DatePicker({flat:e.settings.flat,lang:l,calendars:e.settings.calendars,date:s,current:this._formatDate(s),onChange:i.proxy(function(e,t){var s=i("div[data-bc-id='"+this.id+"']");i("input.hiddenInput",s).val(t.getTime()),i("input.textInput",s).length>0&&(i("input.textInput",s).val(e),i("input.textInput",s).DatePickerHide())},e)}),e.settings.flat||n.on("focus","input.textInput",function(){i("input.textInput, div.datepicker",n).DatePickerShow()})}},_submit:function(e,t,i){this._validateForm(e,t,i)&&(!1!==t.logConversion&&this.blueConicClient.createEvent("CONVERSION",t.attributionId),this._storeFormValues(e,t,i),this.blueConicClient.profile.updateProfile(this.jQuery.proxy(function(){this._handleActions(t.actions,t.attributionId,e,i)},this)))},_handleActions:function(e,t,i,s){if(e){var n=new window._bcp.utils.AfterSubmitActionHandler(this.blueConicClient,s,this.jQuery,t);e.forEach(function(e){n.executeAction(e,i)},this)}},_getField:function(e,t){var i=e.closest(".fieldHolder").attr("data-bc-id");if(i&&void 0!==i){for(var s,n=0;n<t.fields.length;n++){var a=t.fields[n];if(a&&a.id&&void 0!==a.id&&a.id===i){s=a;break}}return s}},_addFormListeners:function(e,t,i){var s=this.jQuery,n=this;this._addDatePickerHandler(e,t,i),s('input[type="submit"]',e).click(function(a){a.preventDefault();var l=n._getField(s(this),t);l&&l.settings&&!1===l.settings.logClick||n.blueConicClient.createEvent("CLICK",t.attributionId),n._submit(e,t,i)}),s('input[type="button"]',e).click(function(){var a=n._getField(s(this),t);a&&(a.settings&&!1!==a.settings.logClick&&n.blueConicClient.createEvent("CLICK",t.attributionId),n._handleActions(a.settings.actions,t.attributionId,e,i))}),1===t.fields.length&&"RadioButtonList"===t.fields[0].fieldType&&s('input[type="radio"]',e).click(s.proxy(function(s){s.preventDefault(),this.blueConicClient.createEvent("CLICK",t.attributionId),this._submit(e,t,i)},this))},_validateForm:function(e,t,i){var s=e.find(".fieldHolder");e.find("span.errormsg").remove(),s.removeClass("error");for(var n=!0,a=0;a<t.fields.length;a++){var l=t.fields[a],r=this.jQuery(s[a]),o=r.find("input, textarea, select"),d=!1;if(l.settings.required)switch(l.fieldType){case"CheckboxList":case"Checkbox":case"RadioButtonList":case"RadioButton":0===o.filter(":checked").length&&(d=!0);break;case"DatePicker":o.filter(".hiddenInput").val()||(d=!0);break;default:o.val()||(d=!0)}var c=!1;if(!d&&l.settings.validation){var u=this.jQuery.trim(o.val());if(u)switch(l.settings.validation){case"email":u.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)||(c=!0);break;case"number":u.match(/^\d+$/)||(c=!0);break;case"regexp":try{l.settings.validation_regexp&&!u.match(l.settings.validation_regexp)&&(c=!0)}catch(e){console.error(e)}}}if((d||c)&&(n=!1,r.addClass("error"),c||l.settings.validation_failed_msg)){var f="nl"===i.getLocale()?"nl":"default";r.before('<span class="errormsg">'+(l.settings.validation_failed_msg?l.settings.validation_failed_msg:this.languageLabels[f].defaultValidation)+"</span")}}return n},_storeFormValues:function(e,t,i){for(var s=i.getProfile(),n=0;n<t.fields.length;n++){var a,l=t.fields[n],r=this.jQuery(e).find("div[data-bc-id = '"+l.id+"']").find("input, textarea, select");if(l.settings.storeproperty)switch(l.fieldType){case"CheckboxList":case"Checkbox":case"RadioButtonList":case"RadioButton":for(var o=[],d=r.filter(":checked"),c=0;c<d.length;c++){var u=this.jQuery(d[c]).val();u=unescape(u),o.push(u)}if("set"===l.settings.overwriteValue)s.setValues(l.settings.storeproperty,o);else for(var f=0;f<o.length;f++)s.addValue(l.settings.storeproperty,o[f]);break;case"DatePicker":(a=r.filter(".hiddenInput").val())&&("set"===l.settings.overwriteValue?s.setValue(l.settings.storeproperty,a):s.addValue(l.settings.storeproperty,a));break;default:a=unescape(r.val()),"set"===l.settings.overwriteValue?s.setValue(l.settings.storeproperty,a):s.addValue(l.settings.storeproperty,a)}}},_tmpl:function(e,t){var i=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):this.cache[e]=this.cache[e]||tmpl(document.getElementById(e).innerHTML);return t?i(t):i}});var a = [];var i='forms';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/1.1.22/frontend/src/node_modules/@blueconic/actionhandlers-frontend/AfterSubmitActionHandler.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.22/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){if(this.blueConicClient=a,this.context=b?b:null,this.parameters=this.context.getParameters(),this._initPublishedEvents(),!!this.parameters){"true"!==this.parameters.hasOverlay[0]||this._isViewEventPublished()||(this._setViewEventPublished(!0),this.blueConicClient.createEvent("VIEW",this.context.getInteractionId()));var c=this.parameters.positions;if(c)for(var d,e=0;e<c.length;e++)d=c[e],this.blueConicClient.position.subscribe(d,this,this._handlePosition)}},_initPublishedEvents:function(){window._bcp=window._bcp||{},window._bcp.publishedEvents=window._bcp.publishedEvents||{},window._bcp.publishedEvents.viewEvent=window._bcp.publishedEvents.viewEvent||{},window._bcp.publishedEvents.clickEvent=window._bcp.publishedEvents.clickEvent||{}},_handleClick:function(){this._isClickEventPublished()||(this._setClickEventPublished(!0),this.blueConicClient.createEvent("CLICK",this.context.getInteractionId()))},_handlePosition:function(a){this._isViewEventPublished()||this.blueConicClient.isInEditMode()||(this._setViewEventPublished(!0),this.blueConicClient.createEvent("VIEW",this.context.getInteractionId()));var b=this;try{var c="bcCtrl"+this.context.getInteractionId();if(this.jQuery(a+" a").off("click."+c).on("click."+c,function(){b._handleClick()}),this.jQuery(document).off("click."+c).on("click."+c,a+" a",function(){b._handleClick()}),this.jQuery(document).off("submit."+c).on("submit."+c,a+" form",function(){b._handleClick()}),0<this.jQuery(a).find("iframe").length){window.focus();var d=!1,e=this.jQuery(this.jQuery(a).find("iframe"));e.off("mouseenter."+c).on("mouseenter."+c,function(){d=!0}),e.off("mouseleave."+c).on("mouseleave."+c,function(){d=!1}),this.jQuery(window).off("blur."+c).on("blur."+c,this.jQuery.proxy(function(){d&&this._handleClick()},this))}}catch(a){}},onLoad:function(){if(this.parameters){var a=this.parameters.positions;if(a)for(var b,c=0;c<a.length;c++)b=a[c],0<this.jQuery(b).length&&this._handlePosition(b)}},_isViewEventPublished:function(){return!!window._bcp.publishedEvents.viewEvent[this.context.getInteractionId()]},_setViewEventPublished:function(a){window._bcp.publishedEvents.viewEvent[this.context.getInteractionId()]=a},_isClickEventPublished:function(){return!!window._bcp.publishedEvents.clickEvent[this.context.getInteractionId()]},_setClickEventPublished:function(a){window._bcp.publishedEvents.clickEvent[this.context.getInteractionId()]=a}});var a = [];var i='globallistener_controlgroup';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.0.9/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({PF_PROPERTY_PREFIX:"gtmpf",BLUECONIC_EVENT_PREFIX:"GTM:",init:function(e,t){this.blueConicClient=e,this.context=t||null,this.profile=this.context.getProfile(),this.parameters=this.context.getParameters(),this.parameters=this.migrate(this.parameters),this.objectName=this.parameters.objectname&&this.parameters.objectname.length>0&&this.parameters.objectname[0]?this.parameters.objectname[0]:"dataLayer",this._goals=[];var i=t.getGoals().reduce(function(e,t){return e[t.getId()]=!0,e},{});if(this.parameters.goalParameters)for(var n=0;n<this.parameters.goalParameters.length;n++){var a=e.json.parse(this.parameters.goalParameters[n]);a.active&&i[a.id]&&this._goals.push(a)}this.connectionContext={LAST_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"lt"+this.context.getInteractionId(),VARIABLE_STATE_PUSH_PROPERTY:this.PF_PROPERTY_PREFIX+"st"+this.context.getInteractionId(),profile:this.profile,variables:[],SENT_TO_SYSTEM_PROPERTY:"sent_to_system",SENT_TO_CONNECTION_PROPERTY:"sent_to_connection",RECEIVED_FROM_SYSTEM_PROPERTY:"received_from_system",RECEIVED_FROM_CONNECTION_PROPERTY:"received_from_connection"}},initDataLayerUtil:function(){this.bcConnectionUtil.md5Lib=this.md5,this._bcDatalayerUtil=new this.BlueConicDataLayerUtil(this.objectName,this.blueConicClient,this.bcConnectionUtil,this.context,this.connectionContext,this.profile),this._bcDatalayerUtil.LAST_PUSH_PROPERTY=this.PF_PROPERTY_PREFIX+"lt"+this.context.getInteractionId(),this._bcDatalayerUtil.VARIABLE_STATE_PUSH_PROPERTY=this.PF_PROPERTY_PREFIX+"st"+this.context.getInteractionId()},onLoad:function(){this.initDataLayerUtil();var e=this,t=0;(function i(){if(e._bcDatalayerUtil.getDataLayer())e._handleGoals();else{if(t>20)return;t++,window.setTimeout(i,250)}}).call(this)},_handleGoals:function(){for(var e=0;e<this._goals.length;e++){var t=this._goals[e],i=t.parameters.segment?t.parameters.segment[0]:null;this._bcDatalayerUtil.visitorInSegment(i)&&("export"===t.type&&this._handleExportGoal(t.parameters,t.id),"import"===t.type&&this._handleImportGoal(t.parameters))}},_handleImportGoal:function(e){var t=this._bcDatalayerUtil.getDataLayer();if(t){this._bcDatalayerUtil.doImport(e),this._publishEvents();var i=this,n=t.length;window.setInterval(function(){t=i._bcDatalayerUtil.getDataLayer(),n!==t.length&&(i._publishEvents(n),n=t.length)},1e3)}},_publishEvents:function(e){for(var t=this._bcDatalayerUtil.getDataLayer(),i=e=e||0;i<t.length;i++){var n=t[i].event;n&&this.blueConicClient.event.publish(this.BLUECONIC_EVENT_PREFIX+n,[t[i]])}},_handleExportGoal:function(e,t){this._bcDatalayerUtil.doExport(e,t);var i=Array.isArray(e.push_interactions)&&"true"===e.push_interactions[0],n=Array.isArray(e.passOnEvents)&&"true"===e.passOnEvents[0];!window[this.objectName]||window[this.objectName].push?(i&&this.blueConicClient.event.subscribe("VIEW",this,this._pushInteractionView),n&&this._subscribeToPassOnEvents()):console.warn("window."+this.objectName+" does not have a push function: is the correct Object Name entered?")},getPreloadProperties:function(){for(var e=[this.connectionContext.SENT_TO_SYSTEM_PROPERTY,this.connectionContext.SENT_TO_CONNECTION_PROPERTY,this.connectionContext.RECEIVED_FROM_SYSTEM_PROPERTY,this.connectionContext.RECEIVED_FROM_CONNECTION_PROPERTY],t=0;t<this._goals.length;t++){var i=this._goals[t];if("export"===i.type){e.push(this.PF_PROPERTY_PREFIX+"st"+this.context.getInteractionId()+"_"+i.id),e.push(this.PF_PROPERTY_PREFIX+"lt"+this.context.getInteractionId()+"_"+i.id);for(var n=this.blueConicClient.json.parse(i.parameters.exportMapping),a=0;a<n.length;a++)"property"===n[a].from.dataType&&n[a].from.values.length>0&&e.push(n[a].from.values[0].id)}else for(var r=this.blueConicClient.json.parse(i.parameters.importMapping),s=0;s<r.length;s++)r[s].to.values.length>0&&e.push(r[s].to.values[0].id)}return e},_pushInteractionView:function(e,t){var i=this.blueConicClient.getInteractionNamesById(t);if(null!==i){var n=i.variantName?i.name+" / "+i.variantName:i.name;window[this.objectName].push({event:"bcInteractionView",name:n})}},_subscribeToPassOnEvents:function(){var e,t=[["inactivity","Inactivity"],["exitintent","Exit Intent"],["cm_firstview","Content Meter View 1"],["cm_exceeded","Content Meter Exceeded"],["cm_lastview","Content Meter Last View"],["cm_excluded","Content Meter Excluded View"],["cm_bottom","Content Meter Bottom Range"],["cm_middle","Content Meter Middle Range"],["cm_top","Content Meter Top Range"],["cm_already_viewed","Content Meter Already Viewed"],["cm_free_view","Content Meter Free View"],["cm_last_free_view","Content Meter Last Free View"]];for(e=2;e<10;e++)t.push(["cm_view_"+e,"Content Meter View "+e]);for(e=1;e<10;e++)t.push(["cm_free_view_"+e,"Content Meter Free View "+e]);var i=this;t.forEach(function(e){i.blueConicClient.event.subscribe(e[0],i,function(){window[this.objectName].push({event:"bcEvent",bcEventName:e[1]})})})},migrate:function(e){var t=parseInt(e.version||"2");return!e.usecases&&!e.variables||e.goalParameters||(t=1),t<2&&(e=this._migrateToV2(e),t=2),t<3&&(e=this._migrateToV3(e)),e},_migrateToV2:function(e){var t={objectname:e.objectname},i=[];if(-1!==e.usecases.indexOf("uc2")){var n={id:1,name:"Import",active:!0,type:"import"},a=[];if(e.importVariables&&e.importVariables.length>0)for(var r=this.blueConicClient.json.parse(e.importVariables[0]),s=0;s<r.length;s++)a.push({from:{fieldId:r[s].fieldLabel},to:{type:"property",property:r[s].property},restriction:r[s].restriction,mergeRule:r[s].mergeRule});n.parameters={importMapping:[this.blueConicClient.json.stringify(a)]},i.push(this.blueConicClient.json.stringify(n))}if(-1!==e.usecases.indexOf("uc1")){var o={id:2,name:"Export",active:!0,type:"export"},l=[];if(e.variables&&e.variables.length>0)for(var c=this.blueConicClient.json.parse(e.variables[0]),h=0;h<c.length;h++)l.push({to:{fieldId:c[h].key},from:{type:"pm"===c[h].type?"permission":c[h].type,property:c[h].property,segments:c[h].segments,fieldId:c[h].text}});o.parameters={exportMapping:[this.blueConicClient.json.stringify(l)],eventname:e.eventname,push_frequency:e.push_frequency,push_interactions:e.push_interactions,passOnEvents:e.passOnEvents,triggerEvent:e.triggerEvent},i.push(this.blueConicClient.json.stringify(o))}return t.goalParameters=i,t},_migrateToV3:function(e){return e.goalParameters=(e.goalParameters||[]).map(JSON.parse).map(function(e){if("export"===e.type){var t=e.parameters.eventname?e.parameters.eventname[0]:null;e.parameters.eventname=[t||"BlueConic"]}return JSON.stringify(e)}),e}});var a = [];var i='gtmconnection';a.push({url: p + i + '/3.0.2/frontend/src/node_modules/@blueconic/connection_lib/connection_lib.js', sharing: 'local'});a.push({url: p + i + '/3.0.2/frontend/src/node_modules/@blueconic/datalayer_lib/datalayer_lib.js', sharing: 'local'});a.push({url: p + i + '/3.0.2/frontend/src/lib/jsonpath.min.js', sharing: 'local'});a.push({url: p + i + '/3.0.2/frontend/src/lib/md5.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/3.0.2/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({_timeout:null,_timestamp:null,_interval:200,init:function(a,b){this.blueConicClient=a,this.context=b||null},onLoad:function(){var a=this.jQuery,b=this;this.blueConicClient.event.subscribe(this.blueConicClient.event.onUrlChange,this,function(){this._setTimestamp(),clearTimeout(b._timeoutID),b._timeoutID=setTimeout(function(){b._checkTimeout()},b._interval)}),this._setTimestamp();var c,d=this.context.getParameters(),e="true"===d.clicks[0],f="true"===d.inputs[0],g=d.scrolling;c=!g||"true"===d.scrolling[0],this._timeout=d.timeout[0],this._timeout?!isNaN(parseInt(this._timeout))&&(this._timeout=1e3*parseInt(this._timeout)):this._timeout=60000;(e||f||c)&&(e&&a(document).on("click","*",function(){b._setTimestamp()}),f&&(a("input").on("keyup",function(){b._setTimestamp()}),a("textarea").on("keyup",function(){b._setTimestamp()}),a("select").on("change",function(){b._setTimestamp()}),a("input").on("change",function(){b._setTimestamp()})),c&&a(window).scroll(function(){b._setTimestamp()}),this._timeoutID=setTimeout(function(){b._checkTimeout()},b._interval))},_handleInactivity:function(){this.blueConicClient.createEvent("inactivity")},_checkTimeout:function(){var a=new Date().getTime(),b=this;a-this._timestamp>this._timeout?this._handleInactivity():b._timeoutID=setTimeout(function(){b._checkTimeout()},b._interval)},_setTimestamp:function(){this._timestamp=new Date().getTime()}});var a = [];var i='inactivitylistener';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.11/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.interaction=b},onLoad:function(){var a=this.interaction.getProfile(),b=this.interaction.getParameters(),c=b.ip_range_rules?b.ip_range_rules[0]:b.ip_range_rules,d=b.property?b.property[0]:b.property,e=this.blueConicClient.getIPAddress();if(c&&d&&e&&(c=this.blueConicClient.json.parse(c),0!==c.length)){for(var f=!1,g=0;g<c.rules.length;g++){var h=c.rules[g],i=h.lowest,k=h.highest,l=h.addset,m=h.values;if(i&&k&&m&&0<m.length){var n,o,p;if(1<i.split(":").length&&1<k.split(":").length&&1<e.split(":").length?(n=this.ip2num(this.ip6hexToNumber(e)),o=this.ip2num(this.ip6hexToNumber(i)),p=this.ip2num(this.ip6hexToNumber(k))):(n=this.ip2num(e),o=this.ip2num(i),p=this.ip2num(k)),n<=p&&n>=o)if(f=!0,"add"===l)for(var q=0;q<m.length;q++)a.addValue(d,m[q]);else a.setValues(d,m)}}f&&this.blueConicClient.profile.updateProfile()}},ip2num:function(b){var c=b.split(".");0===c.length&&(c=b.split(":")),4===c.length&&c.unshift(0,0,0,0);var d=256*(256*(256*(256*(256*(256*(256*+c[0]+ +c[1])+ +c[2])+ +c[3])+ +c[4])+ +c[5])+ +c[6])+1*+c[7];return d},ip6hexToNumber:function(a){for(var b=a.split(":"),c=[],d=0;d<b.length;d++)if(""===b[d])for(var e=0;e<=8-b.length;e++)c.push(0);else c.push(parseInt(b[d],16));return c.join(".")}});var a = [];var i='iplistenerinteractiontype';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/2.0.8/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(t,e){this.blueConicClient=t,this.context=e,this.parameters=this.context.getParameters(),this.isInEditMode=this.blueConicClient.isInEditMode(),this.fancyBoxLib="frontend/src/lib/fancybox/jquery.fancybox.pack.js";var i=this.context.getInteractionTypeId();this.baseURL=this.blueConicClient.getBaseURL(i);var n=this.parameters.content+"";this.htmlFragment=this.createElement(n),this.profile=t.profile.getProfile(),this.inlineCss=null,this._timestamp=null,this._observer=null,this._eventListenerFunction=null,this._lightboxTriggered=!1,this.blueConicClient._renderedInteractions=this.blueConicClient._renderedInteractions||[],this.blueConicClient.event.subscribe(this.blueConicClient.event.onUrlChange,this,function(){var t=this.blueConicClient.util.array.indexOfArray(this.blueConicClient._renderedInteractions,this.context.getInteractionId());this.blueConicClient._renderedInteractions.splice(t,1)})},getPreloadProperties:function(){for(var t,e=this.context.getParameters().content+"",i=/data-bc-preload="([^"]*)"/g,n=[];null!==(t=i.exec(e));)for(var o=t[1].split(","),r=0;r<o.length;r++)n.push(o[r]);for(var s=this.htmlFragment?this._getPropertiesFromPlaceholders(this.htmlFragment.innerHTML):[],a=0;a<n.length;a++)s.push(n[a]);return s},onMessageReceived:function(t){this.blueConicClient.event.publish("lightbox.messageReceived",t)},onLoad:function(){window.bc=window.bc||{},window.bc.jQuery=this.jQuery,window.bc.$=this.jQuery,window.bcFancyboxLoading?this.blueConicClient.event.subscribe("bcFancyboxLoaded",this,function(){this.onLoad()}):this.blueConicClient._lightboxinteractiontypeFancybox?(this.jQuery.fancybox=this.blueConicClient._lightboxinteractiontypeFancybox,this._onLoadWithLibrary()):(window.bcFancyboxLoading=!0,this.blueConicClient.util.loadScript(this.baseURL+this.fancyBoxLib,this,function(){this.blueConicClient._loadLightboxInteractionTypeFancyBox(window,document,this.jQuery),this.blueConicClient._lightboxinteractiontypeFancybox=this.jQuery.fancybox,delete this.blueConicClient._loadLightboxInteractionTypeFancyBox,this._onLoadWithLibrary(),window.bcFancyboxLoading=!1,this.blueConicClient.event.publish("bcFancyboxLoaded")}))},_onLoadWithLibrary:function(){if(this.isInEditMode)this.showLightbox();else{var t=this.parameters.selected_when||[],e=this.getParameter("click_selector");e&&-1!==this.blueConicClient.util.array.indexOfArray(t,"click_selector")&&this._addClickTriggerBindings(e);var i=this.getParameter("content_condition");i&&-1!==this.blueConicClient.util.array.indexOfArray(t,"content_condition")&&this._addContentPolling(i);var n=this.parameters.scroll_depth&&this.parameters.scroll_depth[0]&&!isNaN(this.parameters.scroll_depth[0])?parseInt(this.parameters.scroll_depth[0]):0;n&&-1!==this.blueConicClient.util.array.indexOfArray(t,"scroll_depth")&&this._addScrollBinding(n),0===t.length&&this.showLightbox(),this._addCloseEventHandler()}},_checkScrollCondition:function(t){this.jQuery(window).scrollTop()/(this.jQuery(document).height()-window.innerHeight)*100>=t&&this.showLightbox()},_addScrollBinding:function(t){this._checkScrollCondition(t),this.jQuery(window).scroll(this.jQuery.proxy(function(){this._checkScrollCondition(t)},this))},_addClickTriggerBindings:function(t){try{var e=this.jQuery(t);e.length>0?e.off("click.lightboxinteractiontype").on("click.lightboxinteractiontype",this.jQuery.proxy(function(){this.showLightbox(!0)},this)):this.blueConicClient.position.subscribe(t,this,this.jQuery.proxy(this._addClickTriggerBindings,this,t))}catch(t){}},_addContentPolling:function(t){this._checkContentCondition(t);var e=this,i=document.getElementsByTagName("body")[0];if(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)this._observer=new MutationObserver(function(){e._observeContentChanges(t)}),this._observer.observe(i,{childList:!0,subtree:!0});else if(window.addEventListener)this._eventListenerFunction=function(){e._observeContentChanges(t)},i.addEventListener("DOMNodeInserted",this._eventListenerFunction,!1);else var n=setInterval(function(){e._lightboxTriggered?clearInterval(n):e._checkContentCondition(t)},500)},_observeContentChanges:function(t){if(this._lightboxTriggered){this._observer?this._observer.disconnect():document.getElementsByTagName("body")[0].removeEventListener("DOMNodeInserted",this._eventListenerFunction,!1)}else{var e=this,i=(new Date).getTime();this._timestamp=i,setTimeout(function(){e._timestamp!==i||e._lightboxTriggered||e._checkContentCondition(t)},250)}},_checkContentCondition:function(t){this.jQuery(t).length>0&&this.jQuery(t).html()&&this.jQuery(t).html().length>0&&this.showLightbox()},closeLightbox:function(){this.isInEditMode||this.jQuery.fancybox.close()},_addCloseEventHandler:function(){this.blueConicClient.event.subscribe("closeoverlay",this,function(t,e){e instanceof Array&&e[0]===this.context.getInteractionId()&&this.closeLightbox()})},showLightbox:function(t){if(-1===this.blueConicClient.util.array.indexOfArray(this.blueConicClient._renderedInteractions,this.context.getInteractionId())){this.blueConicClient._renderedInteractions.push(this.context.getInteractionId());this.parameters.selected_when;if(!this._lightboxTriggered||this.isInEditMode||t){var e=this.parameters.delay&&this.parameters.delay[0]&&!isNaN(this.parameters.delay[0])?1e3*parseInt(this.parameters.delay[0]):0;!this.isInEditMode&&e>0?window.setTimeout(this.jQuery.proxy(function(){this._showLightbox()},this),e):this._showLightbox()}}},getSettings:function(){var t=null,e=this.getParameter("width")||null,i=this.getParameter("height")||null,n="true"===this.getParameter("hide_after_close");this.htmlFragment&&(t=this.htmlFragment.innerHTML);var o=!(e||i),r=this.getParameter("show_close"),s=this.getParameter("alternative_close"),a={parent:"body",autoSize:o,autoCenter:!1,autoWidth:!e,autoHeight:!i,closeBtn:"false"!==r,width:e||"auto",height:i||"auto",keys:{close:"false"===s||this.isInEditMode?null:[27]},helpers:{overlay:{locked:!0,closeClick:"false"!==s&&!this.isInEditMode}}};this.getParameter("template")&&(a.padding=0),(t||this.isInEditMode)&&(a.content=" ",a.type="inline");var c=this,l=this.jQuery,h=this.getParameter("effect"),d=this.getParameter("effect_slide_direction")||"left";if(this.isInEditMode&&(h="noEffect"),h&&"noEffect"!==h&&("fadeIn"===h?l.fancybox.transitions.openEffect=function(){var t=l.fancybox._getPosition(!0);t.opacity=0,l.fancybox.wrap.css(t).show().animate({opacity:1},{duration:l.fancybox.current.openSpeed,complete:l.fancybox._afterZoomIn})}:"slideIn"===h&&(l.fancybox.transitions.openEffect=function(){var t,e=l.fancybox._getPosition(!0),i=l(window).height(),n=l(window).width(),o=l(".fancybox-wrap").get(0).getBoundingClientRect(),r="top"===d||"bottom"===d?"top":"left";"top"===d||"bottom"===d?t=i-(i-o.height)/2:"left"!==d&&"right"!==d||(t=n-(n-o.width)/2),e[r]="top"===d||"left"===d?parseInt(e[r])-t+"px":parseInt(e[r])+t+"px";var s={},a="top"===d||"left"===d?"+":"-";s[r]=a+"="+t+"px",l.fancybox.wrap.css(e).show().animate(s,{duration:l.fancybox.current.openSpeed,complete:l.fancybox._afterZoomIn})}),l.fancybox.transitions.openEffect&&(a.openMethod="openEffect",a.openSpeed=1e3)),t)a.afterLoad=function(){c.emptyElementsWithAttribute(c.htmlFragment,"div","data-bc-external");try{l(".fancybox-inner").html(c.htmlFragment.innerHTML)}catch(t){console.error("[BC] Error occured when injecting the HTML in the DOM",t)}c.isInEditMode&&c.blueConicClient.event.publish("lightbox.interactionLoaded",{interaction:c}),c.handleComplexElements(l(".fancybox-inner").get(0));var t=c.getParameter("javascript");if(t&&!c.blueConicClient.isInEditMode()){t=t.replace(/(^|\W)blueConicVariantId(\W|$)/g,'$1"'+c.context.getInteractionId()+'"$2'),c._inlineJs=c.jQuery("<script>"+t+"<\/script>");try{c._inlineJs.appendTo(c.jQuery("body"))}catch(t){console.error(t)}}};else if(c.isInEditMode){a.afterLoad=function(){c.blueConicClient.event.publish("lightbox.interactionLoaded",{interaction:c})}}return this.isInEditMode?a.afterShow=function(){l(".fancybox-close").off("click.fb")}:n&&(a.afterShow=function(){l(".fancybox-close").on("click",l.proxy(function(){this.blueConicClient.doNotShowAgain(this.context.getInteractionId())},this))}.bind(this)),a.afterClose=function(){var t=c.blueConicClient.util.array.indexOfArray(c.blueConicClient._renderedInteractions,c.context.getInteractionId());c.blueConicClient._renderedInteractions.splice(t,1)},a},updateLightbox:function(){this.jQuery.fancybox.update()},getCurrentFancyBox:function(){return this.jQuery.fancybox.current},_showLightbox:function(){this._lightboxTriggered=!0;var t=this.jQuery,e=this.getParameter("close_icon"),i=this.getParameter("close_icon_hover"),n=this;function o(){if(!this.isInEditMode){this.blueConicClient.createEvent("VIEW",this.context.getInteractionId()),!!this.parameters.forceclick&&("true"===this.parameters.forceclick[0]||!0===this.parameters.forceclick[0])&&this.blueConicClient.createEvent("CLICK",this.context.getInteractionId());var e=this.getParameter("click_event_selector");if(e){this.jQuery("body").one("click",e,this.jQuery.proxy(function(t){this.lastClickEvent&&this.lastClickEvent.originalEvent===t.originalEvent||this._logClickEvent(t)},this));try{this.jQuery(e).one("click",this.jQuery.proxy(function(t){this.lastClickEvent=t,this._logClickEvent(t)},this))}catch(t){}}}t(".fancybox-wrap").remove(),t(".fancybox-overlay").remove(),this.highZindex=function(t){var e,i=document.getElementsByTagName(t),n=0,o=0;for(o=0;o<i.length;o++)"auto"!==(e=document.defaultView.getComputedStyle(i[o],null).getPropertyValue("z-index"))&&parseInt(e)>n&&(n=parseInt(e));return n}("*"),this.htmlFragment&&(this.emptyElementsWithAttribute(this.htmlFragment,"div","data-bc-external"),this.isInEditMode||this.handlePlaceholders(this.htmlFragment)),t.fancybox(this.getSettings()),this.highZindex>8e3&&this.highZindex+1030<2147483647&&(t(".fancybox-opened").css("z-index",this.highZindex+1030),t(".fancybox-wrap").css("z-index",this.highZindex+920),t(".fancybox-overlay").css("z-index",this.highZindex+910)),this.highZindex+1030>=2147483647&&(t(".fancybox-opened").css("z-index",2147483647),t(".fancybox-wrap").css("z-index",2147483646),t(".fancybox-overlay").css("z-index",2147483645)),this.isInEditMode||this._setupFrontEndBindings()}this.handleStyling(e,i,function(e){if(!e||(console.error(e),n.isInEditMode))n.handleJavascript().then(function(){o.call(n,t)},function(e){if(console.error("[BC] Loading Javascript urls for the lightbox failed:",e),n.isInEditMode)o.call(n,t);else{var i=n.blueConicClient.util.array.indexOfArray(n.blueConicClient._renderedInteractions,n.context.getInteractionId());n.blueConicClient._renderedInteractions.splice(i,1)}});else{var i=n.blueConicClient.util.array.indexOfArray(n.blueConicClient._renderedInteractions,n.context.getInteractionId());n.blueConicClient._renderedInteractions.splice(i,1)}})},_logClickEvent:function(t){t&&t.originalEvent&&t.originalEvent._blueConicLoggedClickEvent===this.context.getInteractionId()||(t&&t.target&&t.target.pathname&&t.target.hostname&&0===t.target.pathname.indexOf("/s/")&&-1!==t.target.hostname.indexOf("blueconic")||(t.originalEvent&&(t.originalEvent._blueConicLoggedClickEvent=this.context.getInteractionId()),this.blueConicClient.createEvent("CLICK",this.context.getInteractionId())))},_setupFrontEndBindings:function(){var t=this.jQuery(".bcLightboxDontShowAgainLink"),e=this.jQuery(".bcLightboxCloseButton");t.length>0&&t.off("click.dontShowAgainLinks").on("click.dontShowAgainLinks",this.jQuery.proxy(function(t){t.preventDefault(),this.blueConicClient.doNotShowAgain(this.context.getInteractionId()),this.closeLightbox()},this)),e.length>0&&e.off("click.closeButtons").on("click.closeButtons",this.jQuery.proxy(function(){this.closeLightbox()},this))},handleComplexElements:function(t){for(var e=this.getElementsWithAttribute(t,"div","data-bc-pluginid"),i=0;i<e.length;i++){var n=e[i],o=n.getAttribute("data-bc-pluginid"),r=n.getAttribute("data-bc-config");if(r)try{var s=r.replace(/\n/g,"\\\\n").replace(/\r/g,"\\\\r").replace(/\t/g,"\\\\t");r=this.blueConicClient.json.parse(s)}catch(t){r=null}this.blueConicClient.event.publish("bcComplexObject",{plugin:o,config:r,node:n,interactionId:this.context.getInteractionId()}),this.isInEditMode||(n.removeAttribute("data-bc-pluginid"),n.removeAttribute("data-bc-config"))}},emptyElementsWithAttribute:function(t,e,i){for(var n=this.getElementsWithAttribute(t,e,i),o=0,r=n.length;o<r;o++){n[o].innerHTML=""}},getElementsWithAttribute:function(t,e,i){for(var n=[],o=t.getElementsByTagName(e),r=0,s=o.length;r<s;r++){var a=o[r];a.getAttribute(i)&&n.push(a)}return n},createElement:function(t){var e;if(!t)return null;try{(e=document.createElement("div")).innerHTML=t}catch(t){return null}return e},handlePlaceholders:function(t){for(var e=this._getPropertiesFromPlaceholders(t.innerHTML),i=0;i<e.length;i++){var n=e[i],o=this.profile.getValue(n)||"",r=new RegExp("\\$\\{"+n+"\\}","g");t.innerHTML=t.innerHTML.replace(r,encodeURI(o))}},_getPropertiesFromPlaceholders:function(t){for(var e,i=/\$\{([a-zA-Z\-_0-9]+)\}/g,n=[];e=i.exec(t);)n.push(e[1]);return n},getParameter:function(t){return this.parameters[t]&&this.parameters[t][0]?this.parameters[t][0]:null},getParameters:function(t){return this.parameters[t]||null},handleJavascript:function(){var t=this.jQuery,e=this.getParameters("javascript_urls"),i=[];if(e){this.javascriptUrls=e;for(var n=0;n<e.length;n++)i.push(this._getLoadScriptDeferred(e[n]))}return t.when.apply(t,i)},_getLoadScriptDeferred:function(t){var e=this.jQuery.Deferred(),i=document.createElement("script");return i.setAttribute("src",t),i.onload=function(){e.resolve()},i.onerror=function(){e.reject('Url "'+t+"\" couldn't be loaded")},document.head.appendChild(i),e},handleStyling:function(t,e,i){var n=this.getParameter("content"),o=[this.baseURL+"frontend/src/lib/fancybox/jquery.fancybox.css"];n&&-1!==n.indexOf("bcLightboxTemplate")||o.push(this.baseURL+"frontend/src/css/lightbox.css");var r=this.getParameter("styling_css");r&&(this.stylingUrl=r,o.push(r));var s="";"true"===this.getParameter("custom_close")&&t&&(s+=".fancybox-close {background-image: url('"+t+"');background-repeat: no-repeat;background-position: center center;background-size: contain;}",e&&(s+=".fancybox-close:hover {background-image: url('"+e+"');background-repeat: no-repeat;background-position: center center;background-size: contain;}"));var a=this.getParameter("close_position"),c=this.getParameter("close_padding");s+=this._getClosePositionStyling(a,c);var l=this.getParameter("styling_css_inline");return l&&(s+=l.replace(/&#xd;/gi,"")),s&&(this.inlineCss=this.jQuery("<style>"+s+"</style>"),this.inlineCss.appendTo(this.jQuery("body"))),this._loadCssUrls(o,i)},_loadCssUrls:function(t,e){var i=(t=t||[]).length,n=0,o=[];if(0===i)return e();function r(){if(++n>=i)return o.length>0?e(o):e()}t.forEach(function(t){if(document.querySelector('link[href="'+t+'"]'))r();else{var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e.onload=r,e.onerror=function(t){o.push(t),r()},document.head.appendChild(e)}})},_getClosePositionStyling:function(t,e){if(!t)return"";null!==e&&"NaN"!==e||(e="-18");var i=".fancybox-close {";switch(t){case"TOP_LEFT":i+="top:"+e+"px; right: unset; bottom: unset; left:"+e+"px;";break;case"BOTTOM_RIGHT":i+="top: unset; right: "+e+"px; bottom: "+e+"px; left: unset;";break;default:i+="top: "+e+"px; right: "+e+"px; bottom: unset; left: unset;"}return i+"}"}});var a = [];var i='lightboxinteractiontype';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/2.2.20/'},{ id : 'html', baseUrl : ps + 'html/1.0.10/'},{ id : 'image', baseUrl : ps + 'image/1.0.2/'},{ id : 'number', baseUrl : ps + 'number/1.0.2/'},{ id : 'string', baseUrl : ps + 'string/1.0.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({EVENT_NAME:"adblock_detected",init:function(a,b){this.blueConicClient=a,this.context=b},getPreloadProperties:function(){var a=this.context.getParameters(),b=a.property?a.property[0]:a.property;return b?[b]:[]},onLoad:function(){var a=this,b=this.context.getProfile(),c=this.context.getParameters(),d=c.property?c.property[0]:c.property;d||(d=this.EVENT_NAME);var e=function(){"no"!==b.getValue(d)&&(b.setValue(d,"no"),a.blueConicClient.profile.updateProfile())},f=function(){"yes"!==b.getValue(d)&&(b.setValue(d,"yes"),a.blueConicClient.profile.updateProfile()),a.blueConicClient.createEvent(a.EVENT_NAME)};window.blockAdBlock?(window.blockAdBlock.on(!1,e),window.blockAdBlock.on(!0,f),window.blockAdBlock.check()):e()}});var a = [];var i='listener_adblock';a.push({url: p + i + '/1.0.16/lib/blockadblock.min.js', sharing: 'none'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.0.16/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b},getPreloadProperties:function(){var a=this.context.getParameters(),b=a.responseProperty?a.responseProperty[0]:a.responseProperty;return b?(this.campaignIdentifierProperty=b,[b]):(this.campaignIdentifierProperty="responded_to_campaigns",["responded_to_campaigns"])},onLoad:function(){var a=this.context.getProfile(),b=this.context.getParameters(),c=this.blueConicClient,d=!1,e=!1,f=b.config?b.config[0]:b.config;if(f){for(var g=this.blueConicClient.json.parse(f),h=0;h<g.length;h++){var i=g[h],j=this.getParameterByName(i.parameter);j&&i.profileProperty&&(a.addValue(i.profileProperty,j),d=!0,i.isCampaignIdentifier&&!e&&(this._bindHandlers(j),e=!0))}d&&c.profile.updateProfile()}},_bindHandlers:function(a){var b=this,c=this.context.getProfile(),d=this.blueConicClient,e=this.jQuery;e("a").click(function(){c.addValue(b.campaignIdentifierProperty,a),d.profile.updateProfile()}),e("form").submit(function(){c.addValue(b.campaignIdentifierProperty,a),d.profile.updateProfile()})},getParameterByName:function(a){if(!a)return"";a=a.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&#]"+a+"=([^&#]*)"),c=b.exec(location.href);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}});var a = [];var i='listener_campaign_tracker';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.0.17/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({PARAMETERS:{ENGAGEMENT_PROPERTY:"engagementProperty",ENGAGEMENT_SCORE_PROPERTY:"engagementScoreProperty",DECAY:"decay",ENGAGEMENT_ON_CHANNEL:"engagementOnChannel"},DEFAULTS:{ENGAGEMENT:"engagement",ENGAGEMENT_SCORE:"engagement_score",VISITS:"visits",CLICKCOUNT:"clickcount"},SCORES:{LOW:"low",MEDIUM:"medium",HIGH:"high"},DEFAULT_DECAY:50,init:function(e,t){this.blueConicClient=e,this.context=t,this.parameters=t.getParameters(),this._channelId=e.getChannelId();var i="true"===this.getParameterValue(this.PARAMETERS.ENGAGEMENT_ON_CHANNEL)&&this._channelId;this.properties={engagement:this.getParameterValue(this.PARAMETERS.ENGAGEMENT_PROPERTY,this.DEFAULTS.ENGAGEMENT),engagementScore:this.getParameterValue(this.PARAMETERS.ENGAGEMENT_SCORE_PROPERTY,this.DEFAULTS.ENGAGEMENT_SCORE),engagementObject:"_"+this.getParameterValue(this.PARAMETERS.ENGAGEMENT_PROPERTY,this.DEFAULTS.ENGAGEMENT),visits:this.DEFAULTS.VISITS+(i?"_"+this._channelId:""),clickcount:this.DEFAULTS.CLICKCOUNT+(i?"_"+this._channelId:"")};var r=new Date(2015,0,1,0,0,0,0),n=(new Date).getTime()-r.getTime();this.days=Math.floor(n/864e5),this.weekNr=Math.floor(this.days/7),this.decay=parseInt(this.getParameterValue(this.PARAMETERS.DECAY))||this.DEFAULT_DECAY},getPreloadProperties:function(){return[this.properties.engagementObject,this.properties.visits,this.properties.clickcount]},onLoad:function(){var e=this.context.getProfile(),t=e.getValue(this.properties.clickcount)?parseInt(e.getValue(this.properties.clickcount)):0,i=e.getValue(this.properties.visits)?parseInt(e.getValue(this.properties.visits)):0,r=e.getValues(this.properties.engagementObject).map(function(e){return this.blueConicClient.json.parse(e)||{}}.bind(this)),n=this._clearInvalidValues(r,i),s=n.cleanedValues,a=this._sumInternalValues(s),h=this._addCurrentWeek(a,t,i),o=this._getCalculated(a,i,t),c=this._calculateScore(o);isNaN(c)||((h||s.length>1||n.removedValues)&&e.setValue(this.properties.engagementObject,JSON.stringify(a)),this._setEngagement(e,c))},getParameterValue:function(e,t){return this.parameters&&this.parameters[e]&&this.parameters[e][0]?this.parameters[e][0]:t},_clearInvalidValues:function(e,t){var i=!1;return e.forEach(function(e){var r=Object.keys(e).filter(function(e){return-1!==e.indexOf("v")}).map(function(e){return parseInt(e.substring(1))});r.sort(function(e,t){return t-e}),r.forEach(function(r){(i||e["v"+r]>t||e["v"+r]<0)&&(delete e["v"+r],delete e["c"+r],i=!0)})},this),{removedValues:i,cleanedValues:e}},_sumInternalValues:function(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(i){t[i]=(t[i]||0)+e[i]})}),t},_setEngagement:function(e,t){var i=this.context.getParameters(),r=parseInt(i.lowTreshold?i.lowTreshold[0]:i.lowTreshold),n=parseInt(i.highTreshold?i.highTreshold[0]:i.highTreshold),s=this.SCORES.MEDIUM;t<r?s=this.SCORES.LOW:t>n&&(s=this.SCORES.HIGH),e.setValue(this.properties.engagementScore,t),e.setValue(this.properties.engagement,s),this.blueConicClient.profile.updateProfile()},_addCurrentWeek:function(e,t,i){var r=!1;return e["v"+this.weekNr]||(e["v"+this.weekNr]=i,r=!0),e["c"+this.weekNr]||(e["c"+this.weekNr]=t,r=!0),r},_calculateScore:function(e){for(var t=0,i=0;i<e.length;i++){var r=this._getWeight(i+1,this.decay),n=e[i];t+=(n.clickCount+5*n.visits)*r}return t=Math.floor(t)},_getWeight:function(e,t){return e<=.1*t?1:e<=.2*t?.8:e<=.4*t?.5:e<=t?.3:.1},_getCalculated:function(e,t,i){for(var r=[],n=this.weekNr;n>0;n--){var s=0;e["v"+n]&&(t-=s=Math.max(t-e["v"+n],0));var a=0;e["c"+n]&&(i-=a=Math.max(i-e["c"+n],0)),r.push({week:n,visits:s,clickCount:a})}return r}});var a = [];var i='listener_engagement';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.0/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(e,r){this.blueConicClient=e,this.context=r},getPreloadProperties:function(){return this.preloadProperties=[],this.context&&(this.preloadProperties=this.getProfilePropertiesFromParameters(this.context.getParameters())),this.preloadProperties},onLoad:function(){var e=this.context.getProfile(),r=this.context.getParameters(),t=r.form_listener_rules?r.form_listener_rules[0]:r.form_listener_rules;if(t){t=this.blueConicClient.json.parse(t),t=!Array.isArray(t)&&t.rules?t.rules:t;for(var i=new window.FormRuleService(this.blueConicClient,e,this.jQuery),o=0;o<t.length;o++)t[o].identifier=this.context.getInteractionId()+"_"+o;i.applyRules(t)}},getProfilePropertiesFromParameters:function(e){var r=[],t=e.form_listener_rules?e.form_listener_rules[0]:e.form_listener_rules;if(!t)return r;t=(t=this.blueConicClient.json.parse(t)).rules||t;for(var i=0;i<t.length;i++){var o=t[i];o.profileproperty&&"set_if_empty"===o.addset&&r.push(o.profileproperty[0].profileproperty)}return r}});var a = [];var i='listener_form_scraper';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/1.1.1/frontend/src/node_modules/@blueconic/frontend-form-rule-service/formRuleService.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(e,t){this.blueConicClient=e,this.context=t||null,this.POLLING_TIMEOUT=1e3,this.parameters=t.getParameters()},getPreloadProperties:function(){return["funnel_timestamp","funnel_busy_with","funnel_steps","funnel_laststep","funnel_lastfield"]},_setLastFocus:function(e){this.context.getProfile().setValue("funnel_lastfield",this._funnelName+" - "+this._currentStepId+": "+e),this.blueConicClient.profile.updateProfile()},_addBindings:function(){var e=this.jQuery,t=this,n=this.context.getInteractionId();e(document).off("focus."+n,"input").on("focus."+n,"input",{},function(){var n=e(this).attr("type");"text"!==n&&"radio"!==n&&"checkbox"!==n&&"number"!==n&&"email"!==n&&"tel"!==n&&"date"!==n&&e(this).attr("type")||t._setLastFocus(t._getFieldName(this))}),e(document).off("focus."+n,"select").on("focus."+n,"select",{},function(){t._setLastFocus(t._getFieldName(this))}),e(document).off("focus."+n,"textarea").on("focus."+n,"textarea",{},function(){t._setLastFocus(t._getFieldName(this))})},_getFieldName:function(e){var t=this.jQuery;return t(e).attr("name")||t(e).attr("id")||t(e).attr("autocomplete")||"Unnamed form field"},_urlsMatches:function(e,t){var n=this.jQuery,r=this;return n(e.urlMatching).filter(function(e,n){return r._urlMatches(n,t)}).length>0},_urlMatches:function(e,t){var n=this._normalizeUrl(t),r=this._normalizeUrl(e.url),i=this._escapeRegularExpressionCharacters(r);try{return new RegExp(i,"i").test(n)}catch(e){return!1}},_escapeRegularExpressionCharacters:function(e){if(e){return e=(e=e.replace(/\.(?!\*)|[\\?]/g,function(e){return"\\"+e})).replace(/(\.\*|\*)/g,".*")}return""},_stepIsVisible:function(e,t){var n=this;return(0,this.jQuery)(e.urlMatching).filter(function(e,r){return n._urlMatches(r,t)&&(!r.word||n._wordIsVisible(r.word))}).length>0},_wordIsVisible:function(e){return(0,this.jQuery)(":contains('"+(e=e.toLowerCase())+"')").filter(function(){for(var t=0;t<this.childNodes.length;t++){var n=this.childNodes[t];if(n.nodeValue&&-1!==n.nodeValue.toLowerCase().indexOf(e))return!0}return!1}).filter(":visible").length>0},_convertStepMapping:function(e,t){var n=this.jQuery,r=this,i=n(t).map(function(e,t){return t.name});return n(e).filter(function(e,t){return 0===t.indexOf(r._funnelName)}).map(function(e,t){var r,s=t.match(/'(.*)' to '(.*)'/);if(s&&s[1]&&s[2]&&-1!==n.inArray(s[1],i)&&-1!==n.inArray(s[2],i))r={source:s[1],target:s[2]};else{var a=t.match(/started at '(.*)'/);a&&a[1]&&-1!==n.inArray(a[1],i)&&(r={start:a[1]})}return r}).filter(function(e,t){return t})},_getFollowedStepsMapping:function(e,t){var n=this.jQuery,r=this.context.getProfile(),i=this._convertStepMapping(r.getValues("funnel_steps"),t),s=null,a=(t.slice(0,t.indexOf(e)),!1);return n(t).each(function(t,r){var u=r.name;(a=a||u===e)||n(i).filter(function(e,t){return t.start===u||t.target===u}).length>0&&(s=u)}),s?this._funnelName+" : '"+s+"' to '"+e+"'":this._funnelName+" : started at '"+e+"'"},_checkWordMatch:function(e){var t=this.jQuery,n=this;setTimeout(function(){var r=!1;t(n._queue).each(function(t,i){n._stepIsVisible(i,e)&&(r=!0)}),r?n._onLoad():n._checkWordMatch(e)},this.POLLING_TIMEOUT)},onLoad:function(){this.jQuery.expr[":"].contains=this.jQuery.expr.createPseudo(this.jQuery.proxy(function(e){return this.jQuery.proxy(function(t){return this.jQuery(t).text().toLowerCase().indexOf(e.toLowerCase())>=0},this)},this)),this.blueConicClient.event.subscribe(this.blueConicClient.event.onUrlChange,this,function(){this._onLoad()}),this._onLoad()},_handleEndReached:function(){var e=this.context.getProfile(),t=e.getValues("funnel_busy_with"),n=t.indexOf(this._funnelName);-1!==t.indexOf(this._funnelName)&&(t.splice(n,1),e.setValues("funnel_busy_with",t))},_removeQueryParameter:function(e,t){var n=e.split("?");if(n.length>=2){for(var r=encodeURIComponent(t)+"=",i=n[1].split(/[&;]/g),s=i.length;s-- >0;)-1!==i[s].lastIndexOf(r,0)&&i.splice(s,1);return e=n[0]+(i.length>0?"?"+i.join("&"):"")}return e},_getUrl:function(){return document.location.origin+document.location.pathname+document.location.search+document.location.hash},_getSteps:function(){var e=this.parameters.steps?this.parameters.steps[0]:this.parameters.steps;return e?this.blueConicClient.json.parse(e):[]},_normalizeUrl:function(e){return e=this._removeUrlPart(e,"http://"),e=this._removeUrlPart(e,"https://"),e=this._removeUrlPart(e,"www.")},_removeUrlPart:function(e,t){return 0===e.indexOf(t)&&(e=e.substring(t.length)),e},_onLoad:function(e){var t=this.jQuery,n=this,r=this.context.getProfile();this._funnelName=this.parameters.funnelName?this.parameters.funnelName[0]:this.parameters.funnelName;var i=this._getSteps();if(0!==i.length){e=e||this._getUrl();var s=t(i).filter(function(t,r){return n._urlsMatches(r,e)});this._queue=[];var a=null;if(t(s).each(function(t,r){n._stepIsVisible(r,e)?a=r:n._queue.push(r)}),this._queue.length>0&&this._checkWordMatch(e),null!==a){this._currentStepId=a.name,this._addBindings(),r.setValue("funnel_laststep",this._funnelName+" - "+this._currentStepId);var u=this._getFollowedStepsMapping(this._currentStepId,i);r.addValue("funnel_steps",u);var o=!1,l=t(i).filter(function(e,t){return(o=o||t.name===a.name)&&t.name!==a.name}),c=r.getValues("funnel_steps"),h=this._funnelName;l.each(function(e,n){c=t(c).filter(function(e,t){return 0!==t.indexOf(h+" :")||-1===t.indexOf("started at '"+n.name+"'")&&-1===t.indexOf("to '"+n.name+"'")}).toArray()}),r.setValues("funnel_steps",c),r.setValue("funnel_lastfield",""),this._currentStepId===i[i.length-1].name?this._handleEndReached():r.addValue("funnel_busy_with",this._funnelName);var f=this.blueConicClient.getCurrentDate().getTime();r.setValue("funnel_timestamp",f),this.blueConicClient.profile.updateProfile()}}}});var a = [];var i='listener_funnel';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.3/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b},getPreloadProperties:function(){return[]},onLoad:function(){}});var a = [];var i='listener_geolocation';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.0.12/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(e,t){this.blueConicClient=e,this.context=t,this.parameters=this.context.getParameters(),this.baseURL=this.blueConicClient.getBaseURL(this.context.getInteractionTypeId()),this.internalProperty="_"+this.context.getInteractionId(),this.BEHAVIOR={PAGEVIEW:"PAGEVIEW",SCROLL:"PAGESCROLL",CLICK:"CLICK",EVENT:"EVENT",FORM:"FORMSUBMIT"},this.SAVE_POINTS_EVENT="engagementRanker.savePoints",this.DEFAULT_RESTRICTION_OPERATOR="AND"},onLoad:function(){window._bcp.engagementRanker.$=this.jQuery,0!==this.preLoadProperties.length&&this._execute()},getPreloadProperties:function(){this.preLoadProperties=[];var e=this.parameters.storeInInterests&&this.parameters.storeInInterests[0]?this.blueConicClient.json.parse(this.parameters.storeInInterests[0]):[];return this.preLoadProperties=e.filter(function(e){return e.property}).map(function(e){return e.property+"_index"}),this.preLoadProperties},_execute:function(){var e=window._bcp.engagementRanker.util,t=window._bcp.engagementRanker.metadataService,i=e.getParameters(this.parameters);this._initExecuter(i);var r=i.restrictions||{rules:[]};if(t.checkRestrictions(r.rules,r.operator||this.DEFAULT_RESTRICTION_OPERATOR)){this._checkScoreProperties(),this._subscribeSavePointsListener();var n=this.parameters.keywordsSources&&this.parameters.keywordsSources[0]?this.blueConicClient.json.parse(this.parameters.keywordsSources[0]):[];(n=n.filter(function(t){return e.getHandler(t.id)||console.log("Could not find handler for",t.id),t.selected&&e.getHandler(t.id)})).forEach(function(e){this._executer.addToRulesMap(e)},this);var s=this.jQuery;return s.when(this._executer.loadLibraries(n)).then(s.proxy(function(){return this._executer.addBindings(),this._executer.executeRulesByEvent(this.BEHAVIOR.PAGEVIEW)},this),function(e){console.log("Failed to load libraries")})}},_initExecuter:function(e,t){this._executer=new window._bcp.engagementRanker.Executer(this.blueConicClient,this.context,e,this.jQuery,this.baseURL,{postponeTimeout:this.postponeTimeout})},_subscribeSavePointsListener:function(){this.blueConicClient.event.subscribe(this.SAVE_POINTS_EVENT,this,function(e,t){(t=t||e).internalProperty===this.internalProperty&&this._savePoints(t.changes)})},_checkScoreProperties:function(){var e=this.blueConicClient.profile.getProfile(),t=!1;this.preLoadProperties.filter(function(t){return 0===e.getValues(t).length}).forEach(function(i){t=!0,e.setValue(i,"0")}),t&&this.blueConicClient.profile.updateProfile()},_savePoints:function(e){if(e&&e.length>0){var t={TIME:(new Date).getTime(),days:this.days,data:e};this.blueConicClient.profile.getProfile().addValue(this.internalProperty,this.blueConicClient.json.stringify(t)),this.blueConicClient.profile.updateProfile()}}});var a = [];var i='listener_interest_ranker';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/Util.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/Executer.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/MetaKeywordRanker.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/TextRanker.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/UrlRanker.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/MetadataService.js', sharing: 'local'});a.push({url: p + i + '/1.3.3/frontend/src/js/JavascriptRanker.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.3.3/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b;var c=new Date(2017,8,1,0,0,0,0),d=this.blueConicClient.getCurrentDate().getTime(),e=d-c.getTime();this.days=Math.floor(e/86400000)},getPreloadProperties:function(){return[]},onLoad:function(){var a=this.context.getProfile(),b=this.context.getParameters(),c=b.property?b.property[0]:b.property;if(c){var d=this.blueConicClient.util.array.ensureArray(b.excludedKeywords),e=this.blueConicClient.json.parse(c)[0].profileproperty,f=[],g=document.getElementsByTagName("meta");if(g)for(var h=!1,j=0,k=g.length;j<k;j++)if("news_keywords"===g[j].name.toLowerCase()){var l=g[j].content.split(",");0===l.length||1===l.length&&""===l[0]||(f=l,h=!0)}else h||0!==f.length||"keywords"!==g[j].name.toLowerCase()||(f=g[j].content.split(","));if(0<f.length){for(var m,n={TIME:new Date().getTime(),days:this.days,points:1,keywords:[]},o=0;o<f.length;o++)m=this._trim(f[o]),""!==m&&-1===this.blueConicClient.util.array.indexOfArray(d,m)&&n.keywords.push(m);0<n.keywords.length&&(a.addValue("_hl_"+e,this.blueConicClient.json.stringify(n)),this.blueConicClient.profile.updateProfile())}}},_trim:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}});var a = [];var i='listener_meta_keywords_ranker';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.2.6/'}]);})();(function(){ 
var InteractionTypeImpl=InteractionType.extend({COUNTER_PROPERTY:"_pageVisitCounter",EVENT:"pagevisitcountreached",NOT_EVENT:"pagevisitcountnotreached",MAX_PAGES_IN_COUNTER:20,init:function(a,b){this.blueConicClient=a;this.context=b;this.profile=this.context.getProfile();this.parameters=this.context.getParameters();this.decay=this.parameters.decay&&!isNaN(this.parameters.decay)?parseInt(this.parameters.decay):45;this.nrVisits=this.parameters.nr_visits&&!isNaN(this.parameters.nr_visits)?parseInt(this.parameters.nr_visits):
3},getPreloadProperties:function(){return[this.COUNTER_PROPERTY]},onLoad:function(){var a=this.profile.getValue(this.COUNTER_PROPERTY),a=a?this.blueConicClient.json.parse(a):{},b=this.jQuery('link[rel="canonical"]').attr("href"),e=(new Date).getTime();b&&(a[b]?(a[b].c+=1,a[b].ts=e):a[b]={c:1,ts:e},a[b].c===this.nrVisits?this.blueConicClient.createEvent(this.EVENT):a[b].c<this.nrVisits&&this.blueConicClient.createEvent(this.NOT_EVENT));var b=0,d=null,c;for(c in a)a.hasOwnProperty(c)&&(a[c].ts<e-864E5*
this.decay?delete a[c]:(d=d?a[c].ts<a[d].ts?c:d:c,b++));b>this.MAX_PAGES_IN_COUNTER&&d&&delete a[d];this.profile.setValue(this.COUNTER_PROPERTY,this.blueConicClient.json.stringify(a));this.blueConicClient.profile.updateProfile()}});
var a = [];var i='listener_page_visit_counter';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : 'https://woodmackenzie.blueconic.net/plugins/listener_page_visit_counter/ts_b40f1848df086103cf9a7ab8d143e1a1/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b;var c=new Date(2017,8,1,0,0,0,0),d=this.blueConicClient.getCurrentDate().getTime(),e=d-c.getTime();this.days=Math.floor(e/86400000)},getPreloadProperties:function(){return[]},onLoad:function(){var a=this.context.getProfile(),b=this.context.getParameters(),c=b.property?b.property[0]:b.property;if(c){var d=this.blueConicClient.json.parse(c)[0].profileproperty,e=this.blueConicClient.getCurrentDate(),f=this._getTimeFrame(e.getHours(),b.locale[0]),g={TIME:new Date().getTime(),data:[]};g.data.push({n:f,p:1,d:this.days}),a.addValue("_hl_"+d,this.blueConicClient.json.stringify(g)),this.blueConicClient.profile.updateProfile()}},_getTimeFrame:function(a,b){return this._getHour(a,b)+" - "+this._getHour(a+1,b)},_getHour:function(a,b){if("en-us"===b){var c=12<=a?"PM":"AM";return a%=12,a=0===a?12:a,a+" "+c}return a=10>a?"0"+a:a,a+":00"}});var a = [];var i='listener_preferred_hour';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.2.4/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({init:function(a,b){this.blueConicClient=a,this.context=b;var c=new Date(2012,0,1,0,0,0,0),d=new Date,e=d.getTime()-c.getTime();this.days=Math.floor(e/86400000)},getPreloadProperties:function(){return[]},onLoad:function(){var a=this.context.getParameters(),b=a.config?a.config[0]:a.config;if(b){var c=this.blueConicClient.json.parse(b),d=document.location.href;(0<=d.indexOf("#")||0<=d.indexOf("?"))&&(d=d.substring(0,d.indexOf("#"))||d.substring(0,d.indexOf("?")));var e,f=d.split("/"),g=!1;for(e=0;e<c.length;e++){var h=c[e],i=f[e+3];h.checked&&h.profileProperty&&!g&&(this._storeEngagement(h.profileProperty,this._getValue(i)),i&&30<i.length&&h.checked&&(g=!0))}this.blueConicClient.profile.updateProfile()}},_getValue:function(a){return a?30<a.length?null:(0<=a.indexOf(".")&&(a=a.substring(0,a.indexOf("."))),isNaN(a)&&"index"!==a&&0!==a.indexOf("index.")?a:null):null},_storeEngagement:function(a,b){if(b){var c=this.context.getProfile(),d={TIME:new Date().getTime()};d[b]={},d[b]["p"+this.days]=1,c.addValue("_"+a,this.blueConicClient.json.stringify(d))}}});var a = [];var i='listener_url_structure';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.0.18/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({blueConicClient:null,context:null,_profile:null,_userLanguage:null,_systemLanguage:null,_language:null,_referrer:null,_hostName:null,_currentUrl:null,_domain:null,ORIGIN_TYPES:{WEB:"web",MOBILE_WEB:"mobile_web",CONNECTION:"connection",MOBILE:"mobile_app"},CONSTANTS:{THIRTY_MINUTES_IN_MS:18e5,UNKNOWN:""},PROFILE_PROPERTIES:{CLICKCOUNT:"clickcount",VISITS:"visits",VISITCLICKS:"visitclicks",LASTVISITDATE:"lastvisitdate",VISITEDSITES:"visitedsites",VISITEDDOMAIN:"visiteddomain",ENTRYPAGE:"entrypage",REFERRERHOST:"referrerhost",REFERRERHOSTS:"referrerhosts",HOSTENTRYPAGE:"hostentrypage",HOSTAVERAGETIME:"hostaveragetime",LASTREFERRERAVERAGE:"lastreferreraverage",AVERAGETIME:"averagetime",TOTALVISITTIME:"totalvisittime",RESOLUTION:"resolution",CURRENTRESOLUTION:"currentresolution",CURRENTSCREENWIDTH:"currentscreenwidth",CURRENTSCREENHEIGHT:"currentscreenheight",ORIGIN_TYPE:"origin_type",ORIGIN_SOURCE:"origin_source",ORIGIN_DETAIL:"origin_detail",DEVICETYPE:"devicetype",RECEIVED_FROM_SYSTEM:"received_from_system",RECEIVED_FROM_CONNECTION:"received_from_connection",MOBILE_APP_ID:"mobile_app_id",MOBILE_APP_NAMEVERSION:"mobile_app_nameversion",LANGUAGE:"language",KEYWORDS:"keywords",CURRENTKEYWORDS:"currentkeywords",CURRENT_UTM_SOURCE:"current_utm_source",CURRENT_UTM_MEDIUM:"current_utm_medium",CURRENT_UTM_TERM:"current_utm_term",CURRENT_UTM_CONTENT:"current_utm_content",CURRENT_UTM_CAMPAIGN:"current_utm_campaign",UTM_SOURCE:"utm_source",UTM_MEDIUM:"utm_medium",UTM_TERM:"utm_term",UTM_CONTENT:"utm_content",UTM_CAMPAIGN:"utm_campaign"},PROFILE_PROPERTIES_FOR_CHANNEL:{},init:function(e,t){this.blueConicClient=e,this.context=t,this._profile=e.profile.getProfile(),this._channelId=e.getChannelId(),this._referrer=document.referrer,this._hostName=window.location.hostname,this._currentUrl=window.location.href,this._domain=document.domain,this._userLanguage=window.navigator.userLanguage,this._systemLanguage=navigator.systemLanguage,this._language=window.navigator.language,this.PROFILE_PROPERTIES_FOR_CHANNEL={CLICKCOUNT:this.PROFILE_PROPERTIES.CLICKCOUNT+"_"+this._channelId,VISITS:this.PROFILE_PROPERTIES.VISITS+"_"+this._channelId,VISITCLICKS:this.PROFILE_PROPERTIES.VISITCLICKS+"_"+this._channelId,LASTVISITDATE:this.PROFILE_PROPERTIES.LASTVISITDATE+"_"+this._channelId}},onPrepare:function(){this._profile&&(this._setLanguageProperties(),this._setResolutionProperties(),this._setReferrerProperties(),this._setCampaignProperties())},onLoad:function(){this._profile&&(this._setReferrerHostOnLoad(),this._setVisitProperties(),this._setOriginProperties(),this.blueConicClient.profile.updateProfile())},getPreloadProperties:function(){return[this.PROFILE_PROPERTIES.CLICKCOUNT,this.PROFILE_PROPERTIES.VISITS,this.PROFILE_PROPERTIES.VISITCLICKS,this.PROFILE_PROPERTIES.LASTVISITDATE,this.PROFILE_PROPERTIES.VISITEDSITES,this.PROFILE_PROPERTIES.ENTRYPAGE,this.PROFILE_PROPERTIES.HOSTENTRYPAGE,this.PROFILE_PROPERTIES.HOSTAVERAGETIME,this.PROFILE_PROPERTIES.LASTREFERRERAVERAGE,this.PROFILE_PROPERTIES.AVERAGETIME,this.PROFILE_PROPERTIES.TOTALVISITTIME,this.PROFILE_PROPERTIES.RESOLUTION,this.PROFILE_PROPERTIES.DEVICETYPE,this.PROFILE_PROPERTIES.ORIGIN_TYPE,this.PROFILE_PROPERTIES.ORIGIN_SOURCE,this.PROFILE_PROPERTIES.ORIGIN_DETAIL,this.PROFILE_PROPERTIES.RECEIVED_FROM_SYSTEM,this.PROFILE_PROPERTIES.RECEIVED_FROM_CONNECTION,this.PROFILE_PROPERTIES.VISITEDDOMAIN,this.PROFILE_PROPERTIES.MOBILE_APP_ID,this.PROFILE_PROPERTIES.MOBILE_APP_NAMEVERSION,this.PROFILE_PROPERTIES_FOR_CHANNEL.CLICKCOUNT,this.PROFILE_PROPERTIES_FOR_CHANNEL.VISITS,this.PROFILE_PROPERTIES_FOR_CHANNEL.VISITCLICKS,this.PROFILE_PROPERTIES_FOR_CHANNEL.LASTVISITDATE]},_setLanguageProperties:function(){var e=this._userLanguage||this._systemLanguage||this._language,t=this._normalizeLocale(e).split("-")[0];t&&this._profile.setValue(this.PROFILE_PROPERTIES.LANGUAGE,t)},_normalizeLocale:function(e){return e&&e.replace("_","-").toLowerCase()},_setResolutionProperties:function(){var e=screen.width,t=screen.height;this._profile.setValue(this.PROFILE_PROPERTIES.CURRENTSCREENWIDTH,e),this._profile.setValue(this.PROFILE_PROPERTIES.CURRENTSCREENHEIGHT,t);var i=e+"x"+t;this._profile.setValue(this.PROFILE_PROPERTIES.CURRENTRESOLUTION,i),this._profile.addValue(this.PROFILE_PROPERTIES.RESOLUTION,i)},_setReferrerProperties:function(){this._setReferrerKeywords(),this._setReferrerHost()},_setReferrerKeywords:function(){var e=this.HELPER.decodeReferrer(this._referrer)||[];e.length>0&&(this._addProfileValues(this.PROFILE_PROPERTIES.KEYWORDS,e),this._profile.setValues(this.PROFILE_PROPERTIES.CURRENTKEYWORDS,e))},_addProfileValues:function(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){this._profile.addValue(e,t)},this)},_setReferrerHost:function(){var e=this._getReferrerHost();e!==this._hostName&&(this._profile.setValue(this.PROFILE_PROPERTIES.ENTRYPAGE,this._currentUrl),e&&(this._profile.setValue(this.PROFILE_PROPERTIES.REFERRERHOST,e),this._profile.addValue(this.PROFILE_PROPERTIES.REFERRERHOSTS,e)))},_setReferrerHostOnLoad:function(){var e=this._getReferrerHost();e!==this._hostName&&this._setHostEntryPageProperty(),this._setHostTotalAndAverageTimeProperty(this._hostName,e)},_getReferrerHost:function(){return this._referrer.replace(/http[s]?:\/\/(.*?)(:|\?|\/|$).*/,"$1")},_setCampaignProperties:function(){[this.PROFILE_PROPERTIES.UTM_SOURCE,this.PROFILE_PROPERTIES.UTM_MEDIUM,this.PROFILE_PROPERTIES.UTM_TERM,this.PROFILE_PROPERTIES.UTM_CONTENT,this.PROFILE_PROPERTIES.UTM_CAMPAIGN].forEach(function(e){var t=this._removeHashPart(this.HELPER._getParameterByName(this._currentUrl,e));t&&(this._profile.setValue("current_"+e,t),this._profile.addValue(e,t))},this)},_setHostEntryPageProperty:function(){this._profile.setValue(this.PROFILE_PROPERTIES.ENTRYPAGE,this._currentUrl);var e=this._getHostEntryPageMapping();e[this._hostName]={entrypage:this._currentUrl},this._profile.setValue(this.PROFILE_PROPERTIES.HOSTENTRYPAGE,JSON.stringify(e))},_getHostEntryPageMapping:function(){return this._safeJSONParse(this._profile.getValue(this.PROFILE_PROPERTIES.HOSTENTRYPAGE))},_safeJSONParse:function(e){try{var t=e.replace(/'/g,'"');return JSON.parse(t)||{}}catch(e){return{}}},_setHostTotalAndAverageTimeProperty:function(e,t){var i=this._safeJSONParse(this._profile.getValue(this.PROFILE_PROPERTIES.HOSTAVERAGETIME));i[e]||(i[e]=this._createNewVisitData());var s=this.blueConicClient.getCurrentDate().getTime(),E=this._profile.getValue(this.PROFILE_PROPERTIES.LASTREFERRERAVERAGE),r=0,R=0,I=0;Object.keys(i).map(function(e){return e.toString()}).forEach(function(_){var n=i[_];this._isSessionExpired(n.enddate)?this._addVisit(n,n.enddate-n.startdate):_===e?n.enddate=s:_===t&&E!==t&&(n.enddate=s,this._profile.setValue(this.PROFILE_PROPERTIES.LASTREFERRERAVERAGE,t)),0!==n.averageTime&&(R++,r+=n.averageTime,I+=n.averageTime*n.visits)},this),this._profile.setValue(this.PROFILE_PROPERTIES.HOSTAVERAGETIME,JSON.stringify(i)),this._profile.setValue(this.PROFILE_PROPERTIES.TOTALVISITTIME,I);var _=R>0?Math.round(r/R):0;this._profile.setValue(this.PROFILE_PROPERTIES.AVERAGETIME,_)},_addVisit:function(e,t){if(t>0){var i=e.averageTime*e.visits+t/1e3;e.visits++,e.averageTime=Math.round(i/e.visits)}var s=this.blueConicClient.getCurrentDate().getTime();e.startdate=s,e.enddate=s},_createNewVisitData:function(){var e=this.blueConicClient.getCurrentDate().getTime();return{startdate:e,enddate:e,averageTime:0,visits:0}},_setPropertyIfEmpty:function(e,t,i){void 0===e[t]&&(e[t]=i)},_setVisitProperties:function(){this._addVisitedDomain(this._domain),this._increaseClickCount(),this._increaseVisits(this.PROFILE_PROPERTIES.VISITS,this.PROFILE_PROPERTIES.VISITCLICKS,this.PROFILE_PROPERTIES.LASTVISITDATE),this._channelId&&this._increaseVisits(this.PROFILE_PROPERTIES_FOR_CHANNEL.VISITS,this.PROFILE_PROPERTIES_FOR_CHANNEL.VISITCLICKS,this.PROFILE_PROPERTIES_FOR_CHANNEL.LASTVISITDATE)},_increaseVisits:function(e,t,i){e=e||this.PROFILE_PROPERTIES.VISITS,t=t||this.PROFILE_PROPERTIES.VISITCLICKS,i=i||this.PROFILE_PROPERTIES.LASTVISITDATE,this._isNewSession(e,i)?(this._resetPageViewsCurrentSession(t),this._increaseSessionCount(e)):this._increasePageViewsCurrentSession(t),this._setLastVisitDate(i,this.blueConicClient.getCurrentDate().getTime())},_setLastVisitDate:function(e,t){e=e||this.PROFILE_PROPERTIES.LASTVISITDATE,this._profile.setValue(e,t)},_addVisitedDomain:function(e){this._hasVisitedDomain(e)||this._profile.addValue(this.PROFILE_PROPERTIES.VISITEDSITES,e)},_hasVisitedDomain:function(e){var t=this._profile.getValues(this.PROFILE_PROPERTIES.VISITEDSITES)||[];return t.length>0&&-1!==t.indexOf(e)},_increaseClickCount:function(){var e=this._getNumberProperty(this.PROFILE_PROPERTIES.CLICKCOUNT);if(this._profile.setValue(this.PROFILE_PROPERTIES.CLICKCOUNT,e+1),this._channelId){var t=this._getNumberProperty(this.PROFILE_PROPERTIES_FOR_CHANNEL.CLICKCOUNT);this._profile.setValue(this.PROFILE_PROPERTIES_FOR_CHANNEL.CLICKCOUNT,t+1)}},_isNewSession:function(e,t){e=e||this.PROFILE_PROPERTIES.VISITS,t=t||this.PROFILE_PROPERTIES.LASTVISITDATE;var i=this._getNumberProperty(e),s=this._getNumberProperty(t)||0;return 0===i||this._isSessionExpired(s)},_isSessionExpired:function(e){return this.blueConicClient.getCurrentDate().getTime()>e+this.CONSTANTS.THIRTY_MINUTES_IN_MS},_resetPageViewsCurrentSession:function(e){e=e||this.PROFILE_PROPERTIES.VISITCLICKS,this._profile.setValue(e,1)},_increasePageViewsCurrentSession:function(e){e=e||this.PROFILE_PROPERTIES.VISITCLICKS;var t=this._getNumberProperty(e);this._profile.setValue(e,t+1)},_increaseSessionCount:function(e){e=e||this.PROFILE_PROPERTIES.VISITS;var t=this._getNumberProperty(e);this._profile.setValue(e,t+1)},_setOriginProperties:function(){var e=this._getOriginCount();e>1?this._mergeOriginProperties():0===e&&this._resolveOriginProperties()},_getOriginCount:function(){var e=this._profile.getValues(this.PROFILE_PROPERTIES.ORIGIN_TYPE)||[],t=this._profile.getValues(this.PROFILE_PROPERTIES.ORIGIN_SOURCE)||[],i=this._profile.getValues(this.PROFILE_PROPERTIES.ORIGIN_DETAIL)||[];return Math.max(e.length,t.length,i.length)},_mergeOriginProperties:function(){this._mergePropertyToUnknown(this.PROFILE_PROPERTIES.ORIGIN_TYPE),this._mergePropertyToUnknown(this.PROFILE_PROPERTIES.ORIGIN_SOURCE),this._mergePropertyToUnknown(this.PROFILE_PROPERTIES.ORIGIN_DETAIL)},_mergePropertyToUnknown:function(e){var t=this._profile.getValues(e)||[];this._profile.setValue(e,1===t.length?t[0]:this.CONSTANTS.UNKNOWN)},_resolveOriginProperties:function(){this._isVisitorOriginFromWeb()?this._resolveOriginForWebVisitor():this._isVisitorOriginFromConnection()?this._resolveOriginForProfileComingFromConnection():this._isVisitorOriginFromMobileApp()&&this._resolveOriginForMobileAppVisitor()},_isVisitorOriginFromWeb:function(){var e=this._profile.getValues(this.PROFILE_PROPERTIES.RECEIVED_FROM_SYSTEM)||[],t=this._profile.getValues(this.PROFILE_PROPERTIES.MOBILE_APP_ID)||[];return 0===e.length&&0===t.length},_isVisitorOriginFromMobileApp:function(){var e=this._profile.getValues(this.PROFILE_PROPERTIES.RECEIVED_FROM_SYSTEM)||[],t=this._profile.getValues(this.PROFILE_PROPERTIES.MOBILE_APP_ID)||[],i=this._getNumberProperty(this.PROFILE_PROPERTIES.VISITS);return t.length>0&&0===e.length&&0===i},_isVisitorOriginFromConnection:function(){var e=this._profile.getValues(this.PROFILE_PROPERTIES.RECEIVED_FROM_SYSTEM),t=this._profile.getValues(this.PROFILE_PROPERTIES.MOBILE_APP_ID),i=this._getNumberProperty(this.PROFILE_PROPERTIES.VISITS);return e&&e.length>0&&t&&0===t.length&&i<=0},_resolveOriginForWebVisitor:function(){var e="",t=this._profile.getValues(this.PROFILE_PROPERTIES.VISITEDSITES)||[],i=this._profile.getValue(this.PROFILE_PROPERTIES.DEVICETYPE)||"",s=this._profile.getValues(this.PROFILE_PROPERTIES.ENTRYPAGE)||[];i&&(e="PC"===i?this.ORIGIN_TYPES.WEB:this.ORIGIN_TYPES.MOBILE_WEB);var E=1===t.length?t[0]:this.CONSTANTS.UNKNOWN,r=1===s.length?s[0]:this.CONSTANTS.UNKNOWN;this._setOriginProfileProperties(e,E,r)},_resolveOriginForProfileComingFromConnection:function(){var e=this._profile.getValues(this.PROFILE_PROPERTIES.RECEIVED_FROM_SYSTEM)||[],t=this._profile.getValues(this.PROFILE_PROPERTIES.RECEIVED_FROM_CONNECTION)||[],i=1===e.length?e[0]:this.CONSTANTS.UNKNOWN,s=1===t.length?t[0]:this.CONSTANTS.UNKNOWN;this._setOriginProfileProperties(this.ORIGIN_TYPES.CONNECTION,i,s)},_resolveOriginForMobileAppVisitor:function(){var e=this._profile.getValues(this.PROFILE_PROPERTIES.MOBILE_APP_ID)||[],t=this._profile.getValues(this.PROFILE_PROPERTIES.MOBILE_APP_NAMEVERSION)||[],i=1===e.length?e[0]:this.CONSTANTS.UNKNOWN,s=1===t.length?t[0]:this.CONSTANTS.UNKNOWN;this._setOriginProfileProperties(this.ORIGIN_TYPES.MOBILE,i,s)},_setOriginProfileProperties:function(e,t,i){this._profile.setValue(this.PROFILE_PROPERTIES.ORIGIN_TYPE,e),this._profile.setValue(this.PROFILE_PROPERTIES.ORIGIN_SOURCE,t),this._profile.setValue(this.PROFILE_PROPERTIES.ORIGIN_DETAIL,i)},_removeHashPart:function(e){if(e){var t=e.indexOf("#");if(-1!==t)return e.substring(0,t)}return e},HELPER:{search_engines:[["google\\.","q"],["bing\\.","q"],["search\\.yahoo\\.","p"],["search\\.aol\\.","q"],["duckduckgo\\.","q"],["baidu\\.","wd"],["ask\\.com","q"],["search\\.lycos\\.","q"],["dogpile\\.com","q"]],substringToHash:function(e){if(e){var t=e.indexOf("#");if(-1!==t)return e.substring(0,t)}return e},decodeReferrer:function(e){for(var t=new RegExp(""),i=0;i<this.search_engines.length;i++){var s=this.search_engines[i];t.compile("^http(s?)://(www\\.)?"+s[0],"i");var E=e.match(t);if(E){var r;if(r=isNaN(s[1])?this._getParameterByName(e,s[1]):E[s[1]+1])return r=decodeURIComponent(r),s.length>2&&s[2]&&(r=decodeURIComponent(r)),r=(r=(r=r.replace(/'|"/g,"")).split(/[\s,+.]+/)).filter(function(e){return e});break}}return null},_getParameterByName:function(e,t){if(!t)return"";t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&#]"+t+"=([^&#]*)").exec(e);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}},_getNumberProperty:function(e){var t=this._profile.getValue(e);if(!t)return 0;try{t=parseInt(t),isNaN(t)&&(t=0)}catch(e){t=0}return t}});var a = [];var i='listenerinteractiontype';blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/1.1.13/'}]);})();(function(){ var InteractionTypeImpl=InteractionType.extend({fallbackLabels:{article:{noStore:{nl:{name:"Titel van het artikel (Bron nog niet geselecteerd)",description:"Beschrijving van het artikel (Bron nog niet geselecteerd)"},default:{name:"Title of the article (source not yet selected)",description:"Description of the article (source not yet selected)"}},noItems:{nl:{name:"Titel van het artikel (aanbevolen artikelen nog niet beschikbaar)",description:"Beschrijving van het artikel (aanbevolen artikelen nog niet beschikbaar)"},default:{name:"Title of the article (recommended articles not yet available)",description:"Description of the article (recommended articles not yet available)"}}},product:{noStore:{nl:{name:"Titel van het product (Bron nog niet geselecteerd)",description:"Beschrijving van het product (Bron nog niet geselecteerd)"},default:{name:"Title of the product (source not yet selected)",description:"Description of the product (source not yet selected)"}},noItems:{nl:{name:"Titel van het product (aanbevolen producten nog niet beschikbaar)",description:"Beschrijving van het product (aanbevolen producten nog niet beschikbaar)"},default:{name:"Title of the product (recommended products not yet available)",description:"Description of the product (recommended products not yet available)"}}}},init:function(e,t){this.blueConicClient=e,this.profile=e.profile.getProfile(),this._templatesLoaded=[],this.baseURL=this.blueConicClient.getBaseURL(t.getInteractionTypeId()),this.context=t,this.locale=t.getLocale(),this.pluginId=t.getInteractionTypeId();var i=this;this.blueConicClient.event.subscribe("bcComplexObject",this,function(e,t){t&&t.plugin===i.pluginId&&(t.config.interactionId=t.interactionId,this.blueConicClient.isInEditMode()||(t.config.id=(new Date).getTime()+Math.round(1e3*Math.random())),this.type="toolbar_content_recommendations"===t.plugin?"article":"product",i._setUniqueId(t.node,t.config.id),i._applyTemplate(t))}),this.blueConicClient.isInEditMode()&&this._subscribeEditModeEvents()},_subscribeEditModeEvents:function(){this.blueConicClient.event.subscribe("recommendations.updateTemplate",this,function(e,t){if(t.message.pluginId===this.pluginId){var i=this._createTemplateObject(t.message.template);this._addTemplateToCache(i),this._applyTemplate({update:!0})}}),this.blueConicClient.event.subscribe("recommendations.updateConfig",this,function(e,t){if(t.message.pluginId===this.pluginId){var i=this._migration(t.message.config);(i=i||{}).settings=i.settings||{};var n=this._getProperties(i);i["data-bc-template-id"]=i.settings.templateId||"";var a='[data-bc-pluginid="'+this.pluginId+'"][data-bc-config*="'+i.id+'"]';this.jQuery(a).attr("data-bc-config",JSON.stringify(i)),n.length>0&&this.jQuery(a).attr("data-bc-preload",n.join(","));var r=this.jQuery(".bcComplexObject"+i.id)[0];if(this.profile.loadValues(n,this,function(){this._applyTemplate({config:i,node:r})}),window.CKEDITOR&&window.CKEDITOR.instances&&Object.keys(window.CKEDITOR.instances).length>0)window.CKEDITOR.instances[Object.keys(window.CKEDITOR.instances)[0]].fire("change")}}),this.blueConicClient.event.subscribe("editorClosed",this,function(){this._sendMessage("recommendations.closeConfigurator")})},_getProperties:function(e){return e&&e.rules?e.rules.reduce(function(e,t){return t&&t.metaDataFilters&&(e=e.concat(t.metaDataFilters.filter(function(e){return e.property}).map(function(e){return e.property}))),e},[]):[]},_setUniqueId:function(e,t){var i="bcComplexObject"+t;this.jQuery(e).addClass(i)},_applyTemplate:function(e){var t=this._migration(e.config);(t=t||{}).settings=t.settings||{};var i=t.settings.templateId;if(i){var n=".bcComplexObject"+t.id;this.jQuery(n).innerHTML="";var a=this;this._loadTemplate(i,function(t){e.update||a._loadHTML(e,t)})}},_getLabelObject:function(e){return"nl"===this.locale?this.fallbackLabels[this.type][e].nl:this.fallbackLabels[this.type][e].default},_getFallbackData:function(e,t){for(var i=this._getLabelObject(e),n=[],a=0;a<t;a++)n.push({name:[i.name],description:[i.description],image:[this.baseURL+"frontend/src/node_modules/@blueconic/frontend-recommendations-rendering/images/fallback600x600.png?"]});return n},_initMetaDataService:function(e){var t=null;if(e){var i=this.context.getConnection(e);if(i){var n=i.getParameters().metadata;t=n?this.blueConicClient.json.parse(n):null}}this._metaDataService=new window.BlueConicMetaDataService(this.jQuery,t,this.type),this._metaDataService.blueConicClient=this.blueConicClient},_getItems:function(e){var t=this.jQuery;this._initMetaDataService(e.settings.connectionId||e["data-bc-connection-id"]);var i=t.Deferred(),n=this._getCount(e),a=this._getQueryStringParametersForRecommendations(e);return a.storeId?this.blueConicClient.recommendation.getRecommendations(a,t.proxy(function(e){var t=e.getItems();(t=t.slice(0,n))&&0!==t.length||!this.blueConicClient.isInEditMode()?i.resolve(t):i.resolve(this._getFallbackData("noItems",n))},this)):i.resolve(this._getFallbackData("noStore",n)),i},_loadHTML:function(e,t){if(t){var i=this.jQuery,n=e.node,a=this._migration(e.config);this._handleStyling(a,t);var r=i('<div class="'+this._getWidthClass(n)+'" data-bc-external="true" data-bc-id="'+a.id+'"></div>');return this._getItems(a).then(i.proxy(function(e){return this._handleItems(e,a,t,r)},this))}},_handleItems:function(e,t,i,n){var a=this.jQuery;if(0!==e.length){var r=this._getDataObject(e,t.interactionId);this._renderTemplate(r,i,n);var s=this._addItemNodes(n,e,t);n.appendTo(s),this.blueConicClient.isInEditMode()||this._bindClicks(n,e[0].recommendationId,t),this._addImageErrorHandler(n,t),this._addJavaScript(i),this._addOnResizeHandler(a(".bcComplexObject"+t.id),n)}else a(".bcComplexObject"+t.id).empty()},_renderTemplate:function(e,t,i){if(e&&t&&window.Mustache){var n=t.getHtml().replace(/<img\s+src=(['"]{{image}}['"])/,"<img data-bc-src=$1"),a=window.Mustache.to_html(n,e);i.empty(),i.append(a),i.find("img[data-bc-src]").each(this.jQuery.proxy(function(e,t){var i=this.jQuery(t),n=i.attr("data-bc-src"),a=i.attr("width");isNaN(a)||(n+="&width="+a);var r=i.attr("height");isNaN(r)||(n+="&height="+r),i.attr("src",n),i.removeAttr("data-bc-src")},this))}},_addItemNodes:function(e,t,i){var n=this.jQuery(".bcComplexObject"+i.id);n.empty();for(var a=0;a<t.length;a++)if(t[a].ID&&t[a].URL)for(var r=e.find('a[href^="'+t[a].URL+'"]'),s=0;s<r.length;s++)r[s].setAttribute("data-bc-item-id",t[a].ID);return n},_addJavaScript:function(e){var t=e.getJavaScript();if(t){var i=document.createElement("script");i.type="text/javascript",i.appendChild(document.createTextNode(t));var n=document.getElementsByTagName("head")[0]||document.documentElement;try{n.insertBefore(i,n.firstChild)}catch(e){console.error(e)}}},_addOnResizeHandler:function(e,t){var i=this.jQuery,n=e[0];i(window).resize(i.proxy(function(){if(e&&n&&t){for(var i=t.attr("class").split(" "),a="",r=0;r<i.length;r++)if(-1!==i[r].search("^bcp.*Width$")){a=i[r];break}var s=this._getWidthClass(n);a!==s&&(t.removeClass(a),t.addClass(s))}},this))},_addImageErrorHandler:function(e,t){(t=t||{}).settings=t.settings||{};var i=t.settings.storeId;e.get(0).addEventListener("error",this.jQuery.proxy(function(e){if("IMG"===e.target.tagName){var t=this.jQuery(e.target),n=t.attr("src");if(t.hide(),!n)return;var a=this.blueConicClient.getHostname();if(-1===n.indexOf(a+"/rest/contentStores/"+i+"/items/"))return;var r=t.closest("a[data-bc-item-id]");if(0===r.length)return;var s=r.attr("data-bc-item-id"),o=r.attr("href");if(!s||!o)return;var l=encodeURIComponent(encodeURIComponent(s));if(-1===n.indexOf("/items/"+l+"/image"))return;this.blueConicClient.recommendation.createEvent({itemId:s,url:o,storeId:i,lastmodified:(new Date).getTime()})}},this),!0)},_getWidthClass:function(e){return e?e.clientWidth<=480?"bcpSmallWidth":e.clientWidth>=1024?"bcpMaxWidth":"bcpDefaultWidth":""},_getUrl:function(){return(this.jQuery('meta[property="og:url"]').attr("content")||this.jQuery('link[rel="canonical"]').attr("href")||window.location.protocol+"//"+window.location.host+window.location.pathname).split("?")[0]},_getQueryStringParametersForRecommendations:function(e){(e=e||{}).settings=e.settings||{};var t={},i=e.settings.storeId;if(!i)return t;t.storeId=i,"No profile present and will not be created."!==this.profile.getId()&&(t.profileId=this.profile.getId());var n=this._getSettings(e);n.debug&&(t.debug=n.debug),n.frequencyCap&&(t.frequencyCap=n.frequencyCap);var a=this._metaDataService.getItemId(document.location.toString());return a&&(t.itemId=a),t.request=this._getRules(e),t},_getSettings:function(e){var t=e.settings||{};return{debug:Boolean(t.debug),frequencyCap:!t.useFrequencyCap||isNaN(t.frequencyCap)||this.blueConicClient.isInEditMode()?null:t.frequencyCap}},_getRules:function(e){return e.rules=e.rules||[],e.rules.map(function(e){return{id:e.isFallback?"default":e.id,filters:this._getRuleFilters(e),boosts:this._getBoostFilters(e),count:e.isFallback?null:e.amount}},this)},_getCount:function(e){return(e=e||{}).rules=e.rules||[],e.rules.filter(function(e){return!e.isFallback}).map(function(e){return e.amount||0}).reduce(function(e,t){return e+t},0)},_getRuleFilters:function(e){var t=[];if(Array.isArray(e.filters)){var i=e.filters.map(function(e){var t="SHOW"===e.filterType&&"IN_STOCK"!==e.id?"_ONLY":"";return e.id+t});t=t.concat(i)}return Array.isArray(e.metaDataFilters)&&e.metaDataFilters.forEach(function(e){t=t.concat(this._handleFilterRules(e,this._metaDataService)||[])},this),t},_getBoostFilters:function(e){return e.algorithms.map(function(e){return e.rampUp||delete e.rampUp,e})},_handleFilterRules:function(e,t){var i=[];switch(e.operatorSetting){case"MUSTNOTBEEMPTY":i.push("hasproperty:"+e.metaDataField);break;case"MUSTBEEMPTY":i.push("!hasproperty:"+e.metaDataField);break;case"CONTAINS":case"DOESNOTCONTAIN":case"CONTAINSALL":case"DOESNOTCONTAINALL":var n=this._handleListRules(e,t);i=i.concat(n);break;case"AFTER":case"BEFORE":case"BETWEEN":var a=this._handleDateRules(e);i=i.concat(a)}return i},_handleListRules:function(e,t){var i=this._getValues(e,t,t.getMetaDataFields());if(0===i.length)return[];var n=[];switch(e.operatorSetting){case"CONTAINS":n=[e.metaDataField+':"'+i.join('","')+'"'];break;case"DOESNOTCONTAINALL":n=["!"+e.metaDataField+':"'+i.join('","')+'"'];break;case"DOESNOTCONTAIN":n=i.map(function(t){return"!"+e.metaDataField+':"'+t+'"'});break;case"CONTAINSALL":n=i.map(function(t){return e.metaDataField+':"'+t+'"'})}return n},_handleDateRules:function(e){if(!e.dateValue&&"BETWEEN"!==e.operatorSetting||!e.dateBetweenValue&&"BETWEEN"===e.operatorSetting)return[];var t=[];if("BETWEEN"!==e.operatorSetting){var i=new Date;switch(e.valueType){case"DAYS":"BEFORE"===e.operatorSetting?(i.setDate(i.getDate()-parseInt(e.dateValue)),t.push(e.metaDataField+"<="+i.toISOString())):(i.setDate(i.getDate()-parseInt(e.dateValue)),t.push(e.metaDataField+">="+i.toISOString()));break;case"HOURS":"BEFORE"===e.operatorSetting?(i.setHours(i.getHours()-parseInt(e.dateValue)),t.push(e.metaDataField+"<="+i.toISOString())):(i.setHours(i.getHours()-parseInt(e.dateValue)),t.push(e.metaDataField+">="+i.toISOString()));break;case"DATE":i=new Date(e.dateValue),t.push("BEFORE"===e.operatorSetting?e.metaDataField+"<="+i.toISOString():e.metaDataField+">="+i.toISOString())}}else{var n=e.dateBetweenValue.start,a=e.dateBetweenValue.end;t.push(e.metaDataField+">="+("string"==typeof n?n:n.toISOString())),t.push(e.metaDataField+"<="+("string"==typeof a?a:a.toISOString()))}return t},_getValues:function(e,t,i){if("values"===e.valueType&&e.values.length>0)return e.values;if("property"===e.valueType)return this.profile.getValues(e.property);if(!i)return t.getFieldValues({fieldId:e.metaDataField,type:"default"});for(var n=0;n<i.length;n++)if(i[n].fieldId===e.metaDataField)return t.getFieldValues(i[n]);return[]},_handleEvent:function(e,t,i,n,a,r,s,o,l){if(n){if(!i)return void(document.location.href=t);var c={storeId:n,action:e,itemId:i,url:t};if("No profile present and will not be created."!==this.profile.getId()&&(c.profileId=this.profile.getId()),s&&r&&(c.debug=!0,c.recommendationId=r),"click"===e){if(l&&l.originalEvent&&l.originalEvent._blueConicLoggedClickEvent===a)return;l&&l.originalEvent&&(l.originalEvent._blueConicLoggedClickEvent=a),this.blueConicClient.createEvent("CLICK",a)}this.blueConicClient.recommendation.createEvent(c,function(){"click"===e&&(o&&"_blank"!==o?window.open(t,o):o&&"_blank"===o||(document.location.href=t))})}},_bindClicks:function(e,t,i){(i=i||{}).settings=i.settings||{};var n=i.settings.storeId,a=i.settings.debug,r=i.interactionId;this.jQuery(e).find("a[data-bc-item-id]").each(this.jQuery.proxy(function(e,i){var s=this.jQuery(i);s.one("click",this.jQuery.proxy(function(e){e.preventDefault();var i=s.attr("href"),o=s.attr("target");o&&"_blank"===o&&window.open(i,o),this._handleEvent("click",i,s.data("bc-item-id"),n,r,t,a,o,e)},this))},this))},_getDataObject:function(e,t){var i=e.length;e=e.map(function(e,t){return e.isFirstItem=0===t,e.isLastItem=t===i-1,e.index=t,e.id&&!e.ID&&(e.ID=e.id),e.url&&!e.URL&&(e.URL=e.url),e.customProperties&&Object.keys(e.customProperties).forEach(function(t){e[t]=e.customProperties[t]}),e});var n=null;t&&(n=this.blueConicClient.getInteractionNamesById(t)||{id:t});var a={},r=this._metaDataService.getMetaDataFields(),s=this._metaDataService.getItemType(r);return r&&s===this.type&&r.forEach(function(e){var t=e.fieldId;"url"!==t&&"id"!==t||(t=t.toUpperCase()),a[t]=this._metaDataService.getFieldValues(e)},this),{interaction:n,current:a,recommendations:e}},_sendMessage:function(e,t){this.blueConicClient.fn.postMessage&&this.blueConicClient.fn.postMessage(e,t)},_handleStyling:function(e,t){(e=e||{}).settings=e.settings||{},e.settings.styling=e.settings.styling||{},this._appendTemplateCss(t,e.id),this._setCssUrl(e),this._appendCustomCss(e)},_appendTemplateCss:function(e,t){var i=this.jQuery,n="bcTemplateCss"+t;i("."+n).remove();var a="";if(e&&e.getCss()){var r=i("<style>"+(a+=e.getCss())+"</style>");r.addClass(n),r.appendTo(i("head"))}},_appendCustomCss:function(e){(e=e||{}).settings=e.settings||{},e.settings.styling=e.settings.styling||{};var t=this.jQuery,i="bcCustomCss"+e.id;if(t("."+i).remove(),e.settings.styling.customCSS){var n=t("<style>"+e.settings.styling.customCSS+"</style>");n.addClass(i),n.appendTo(t("head"))}},_setCssUrl:function(e){(e=e||{}).settings=e.settings||{},e.settings.styling=e.settings.styling||{};var t=this.jQuery;if(!this.blueConicClient.isInEditMode&&e.settings.styling.cssURL)this.blueConicClient.util.loadCSS(e.settings.styling.cssURL);else{var i="bcCssUrl"+e.id;if(t("#"+i).remove(),e.settings.styling.cssURL)t("<link>",{id:i,rel:"stylesheet",type:"text/css",href:e.settings.styling.cssURL}).appendTo("head")}},_loadTemplate:function(e,t){if(!this.blueConicClient.isInEditMode)return this.blueConicClient.getTemplate(e,t);var i=this._getTemplateFromCache(e);if(i)return t(i);var n=this;this.blueConicClient.getTemplate(e,function(e){return n._templatesLoaded.push(e),t(e)})},_getTemplateFromCache:function(e){for(var t=0;t<this._templatesLoaded.length;t++)if(this._templatesLoaded[t].getId()===e)return this._templatesLoaded[t];return null},_addTemplateToCache:function(e){for(var t=e.getId(),i=0;i<this._templatesLoaded.length;i++)if(this._templatesLoaded[i].getId()===t)return void(this._templatesLoaded[i]=e);this._templatesLoaded.push(e)},_createTemplateObject:function(e){return{_css:(e.css||"").replace(/&#xd;/gi,""),_html:(e.html||"").replace(/&#xd;/gi,""),_id:e.id,_javascript:(e.javaScript||"").replace(/&#xd;/gi,""),_precompiledTemplate:e.precompiledTemplate,getHtml:function(){return this._html},getCss:function(){return this._css},getJavaScript:function(){return this._javascript},getId:function(){return this._id}}},_migration:function(e){if(!e||5===e.version)return e;var t=parseInt(e.version||1);return e.strategy&&e.strategy.boostLevels&&!Array.isArray(e.strategy.boostLevels)&&(e=this._migrateV1(e)),t<2&&(e=this._migrationV2(e)),t<3&&(e=this._migrationV3(e)),t<4&&(e=this._migrationV4(e)),t<5&&(e=this._migrationV5(e)),e},_migrateV1:function(e){var t=Object.keys(e.strategy.boostLevels).map(function(t){return{algorithm:t,value:e.strategy.boostLevels[t]}});return e.strategy.boostLevels=t,e},_migrationV2:function(e){var t={id:(e=this._normalizeMigratedData(e)).id,interactionId:e.interactionId,version:2,settings:{useFrequencyCap:e.exceptions.useFrequencyCap,frequencyCap:e.exceptions.frequencyCap,templateId:e.styling.templateId,storeId:e.sources,connectionId:e["data-bc-connection-id"],debug:e.debug||!1,styling:{cssURL:e.styling.cssURLNode,customCSS:e.styling.customCSS}},rules:[{id:(new Date).getTime(),amount:e.styling.amount||4,algorithms:e.strategy.boostLevels.map(function(e){return e.algorithm=e.algorithm.replace(/_n$/,"").toUpperCase(),e.rampup&&(e.rampUp=e.rampup,delete e.rampup),"string"==typeof e.value&&(e.value=parseFloat(e.value.replace(",","."))),e}),filters:e.exceptions.filters.map(function(e){return{id:e.replace("instock","in_stock").replace("only","").toUpperCase(),filterType:-1!==e.indexOf("only")?"SHOW":"HIDE"}}),metaDataFilters:e.exceptions.filterRules}],"data-bc-connection-id":e["data-bc-connection-id"],"data-bc-template-id":e["data-bc-template-id"]};return e.exceptions.hideReadArticles&&(t.rules[0].filters.some(function(e){return e.id="VIEWED"})||t.rules[0].filters.push({id:"VIEWED",filterType:"HIDE"}),delete e.exceptions.hideReadArticles),t},_migrationV3:function(e){if(e)return e.settings&&e.settings.storeId&&(e.sources=e.settings.storeId),e.rules&&(e.rules=e.rules.map(function(e){return e&&e.algorithms&&(e.algorithms=e.algorithms.map(function(e){return e&&"CATEGORY"===e.algorithm&&(e.algorithm="SAME_CATEGORY"),e})),e})),e},_migrationV4:function(e){if(e)return e.settings&&e.settings.connectionId&&(e["data-bc-connection-id"]=e.settings.connectionId),e},_migrationV5:function(e){return this._migrationV4(e)},_normalizeMigratedData:function(e){return(e=e||{}).styling=e.styling||{},e.strategy=e.strategy||{},e.strategy.boostLevels=e.strategy.boostLevels||[],e.exceptions=e.exceptions||{},e.exceptions.filters=e.exceptions.filters||[],e.exceptions.filterRules=e.exceptions.filterRules||[],e}});var a = [];var i='toolbar_content_recommendations';a.push({url: 'http://code.jquery.com/jquery-1.11.2.min.js', sharing: 'local'});a.push({url: p + i + '/2.2.0/frontend/src/node_modules/@blueconic/frontend-recommendations-rendering/lib/mustache-2.2.1.min.js', sharing: 'local'});a.push({url: p + i + '/2.2.0/frontend/src/node_modules/@blueconic/frontend-metadataservice/metaDataService.js', sharing: 'local'});blueConic.fn.registerInteractionType(i, InteractionTypeImpl, a, [{ id : i, baseUrl : ps + i + '/2.2.0/'}]);})();})(blueConicClient);